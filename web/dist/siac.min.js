(function(t,e){for(var a in e)t[a]=e[a]})(window,function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:a})},t.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&'object'==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,'default',{enumerable:!0,value:e}),2&i&&'string'!=typeof e)for(var n in e)t.d(a,n,function(t){return e[t]}.bind(null,n));return a},t.n=function(e){var i=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(i,'a',i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){'use strict';i.r(t);var a=i(2),n=i.n(a),s=i(3),d=i.n(s),o=i(4),l=i.n(o),r=i(5),c=i.n(r),p=i(6),g=i.n(p),f=i(7),h=i.n(f),u=i(8),m=i.n(u),y=i(9),b=i.n(y),x=i(10),v=i.n(x),T=i(11),S=i.n(T),C=i(12),w=i.n(C),k=i(13),L=i.n(k),P=i(14),M=i.n(P),H=i(15),R=i.n(H),I=i(16),E=i.n(I),O=i(17),A=i.n(O),F=i(18),N=i.n(F)},function(){'undefined'==typeof window.SIAC&&(window.SIAC={})},function(){var e=Math.min,t=Math.max;window.SIAC.State={noteId:0,selectedDecks:['-1'],timeout:null,isFrozen:!1,searchOnSelection:!0,searchOnTyping:!0,keepPositionAtRendering:!1,lastHadResults:!1,loadingTimer:null,calTimer:null,gridView:!1,typingDelay:100,showTagInfoOnHover:!0,tagHoverTimeout:750},window.tagHoverCB=null,window.searchMaskTimer=null,window.byId=function(e){return document.getElementById(e)},'undefined'==typeof globalThis&&(window.globalThis=window),window.sendContent=function(e){if(!(e&&e.repeat||null!=pdf.instance||SIAC.State.isFrozen)&&!SIAC.Fields.empty()){showLoading('Typing');let e=SIAC.Fields.getAllFieldsText();pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+e)}},window.searchCurrentField=function(){if(!(displayedNoteId||SIAC.State.isFrozen)){let e=SIAC.Fields.getFocusedFieldText();e&&0!==e.trim().length&&(showLoading('Typing'),pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+e),document.body.classList.contains('siac-wm-fields')&&pycmd('siac-window-mode Both'))}},window.sendSearchFieldContent=function(){showLoading('Searchbar'),html=byId('siac-browser-search-inp').value+'\x1F',pycmd('siac-r-srch-db '+SIAC.State.selectedDecks.toString()+' ~ '+html)},window.searchFor=function(e){showLoading('Note Search'),e+='\x1F',pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+e)},window.searchForUserNote=function(e,t){t&&0!==t.value.length&&t.value.trim()&&(13==e.keyCode?('siac-sidebar-inp'!==t.id&&(t.parentElement.parentElement.style.display='none'),pycmd('siac-r-user-note-search-inp '+t.value)):t.id&&('Escape'===e.key||'Esc'===e.key)?t.parentElement.style.display='none':(clearTimeout(searchMaskTimer),searchMaskTimer=setTimeout(function(){pycmd('siac-r-user-note-search-inp '+t.value)},800)))},window.updateSelectedDecks=function(e){SIAC.State.selectedDecks=[];let t='';e&&$(e).toggleClass('selected'),$('.deck-list-item.selected').each(function(){$(this).data('id')&&(SIAC.State.selectedDecks.push($(this).data('id')),t+=' '+$(this).data('id'))}),pycmd('deckSelection'+t)},window.getSelectionText=function(){if(SIAC.State.searchOnSelection&&!SIAC.State.isFrozen){var e='';window.getSelection?e=window.getSelection().toString():document.selection&&'Control'!=document.selection.type&&(e=document.selection.createRange().text),0<e.trim().length&&'&nbsp;'!=e&&(showLoading('Selection'),pycmd('siac-r-fld-selected '+SIAC.State.selectedDecks.toString()+' ~ '+e))}},window.selectAllDecks=function(){$('.deck-list-item').addClass('selected'),updateSelectedDecks()},window.unselectAllDecks=function(){$('.deck-list-item').removeClass('selected'),updateSelectedDecks()},window.selectDeckWithId=function(e){$('.deck-list-item').removeClass('selected'),$('.deck-list-item').each(function(){$(this).data('id')==e&&$(this).addClass('selected')}),updateSelectedDecks()},window.selectDeckAndSubdecksWithId=function(e){$('.deck-list-item').removeClass('selected'),$(`.deck-list-item[data-id=${e}]`).addClass('selected'),$(`.deck-list-item[data-id=${e}] .deck-list-item`).addClass('selected'),updateSelectedDecks()},window.expandCard=function(e){pycmd('siac-note-stats '+e)},window.showLoading=function(e){SIAC.State.loadingTimer=setTimeout(function(){byId('searchInfo').innerHTML=`<table><tr><td>Status</td><td><b>Searching</b></td></tr><tr><td>Source</td><td><i>${e}</i></td></tr></table>`},1e3)},window.totalOffset=function(e){var t=0,i=0;do t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:i}},window.tagMouseEnter=function(e){SIAC.State.showTagInfoOnHover&&e&&e.parentElement&&!displayedNoteId&&(tagHoverCB=setTimeout(function(){e&&e.parentElement&&e.parentElement.querySelector(':hover')===e&&!byId('siac-tag-info-box-'+$(e).data('stamp'))&&pycmd('siac-tag-info '+$(e).data('stamp')+' '+$(e).data('name'))},SIAC.State.tagHoverTimeout))},window.showTagInfo=function(e){let t=$(e).data('stamp');$(e).css('z-index','9999'),e&&$('#greyout').show();let a=totalOffset(e);a.top+=17;let n=document.getElementsByClassName('siac-tag-info-box');e.parentElement.id&&'tagContainer'===e.parentElement.id?a.top-=byId('tagContainer').scrollTop:1<n.length?0<=e.parentElement.parentElement.parentElement.className.indexOf('siac-tag-info-box-left')&&(a.top-=e.parentElement.parentElement.parentElement.scrollTop):null===byId('cal-info').offsetParent?a.top-=byId('searchResults').scrollTop:a.top-=byId('cal-info-notes').scrollTop;let s='siac-tag-info-box-'+t;a.left>window.outerWidth-a.left&&(a.left-=$('#siac-tag-info-box-'+t).outerWidth(),a.left+=$(e).outerWidth()+2);let d=0;for(var o=0;o<n.length;o++)+$(n[o]).css('z-index')>d&&(d=+$(n[o]).css('z-index'));if($('#siac-tag-info-box-'+t).css('top',a.top).css('left',a.left).css('z-index',d+1),a.top>window.outerHeight-a.top){byId(s).style.visibility='hidden',byId(s).style.display='block';let e=17;1<n.length&&(e=15),$('#'+s).css('top',a.top-$('#'+s).outerHeight()-e),byId(s).style.visibility='visible'}else byId(s).style.display='block'},window.tagMouseLeave=function(e){let t=$(e).data('stamp');if(!($('#siac-tag-info-box-'+t+':hover').length||$(`.tagLbl[data-stamp='${t}']:hover`).length)){let i=document.getElementsByClassName('siac-tag-info-box'),n=+$(e).css('z-index'),s=$('.siac-tag-info-box:hover').first();if(!s.length&&!$(`.tagLbl[data-stamp]:hover`).length)return $('.siac-tag-info-box').remove(),$('.tagLbl').css('z-index','4'),void $('#greyout').hide();if(s.length){let t=+s.css('z-index');if(e.id&&t>n)return;for(var a=0;a<i.length;a++)+$(i[a]).css('z-index')>t&&($(i[a]).remove(),a--)}$(`.tagLbl[data-stamp='${t}']`).first().css('z-index','4'),byId('siac-tag-info-box-'+t)&&$('#siac-tag-info-box-'+t).remove(),(!i||1>i.length)&&$('#greyout').hide()}},window.tagInfoBoxClicked=function(e){let t=+$(e).css('z-index'),a=document.getElementsByClassName('siac-tag-info-box');for(var n=0;n<a.length;n++)+$(a[n]).css('z-index')<t&&($(a[n]).remove(),n--)},window.searchUserNoteTag=function(t,e){t.ctrlKey||t.metaKey?pycmd('siac-create-note-tag-prefill '+e):pycmd('siac-r-user-note-search-tag '+e)},window.switchLeftRight=function(){let e=byId('leftSide'),t=byId('siac-right-side');'leftSide'===e.parentNode.children[0].id?(e.parentNode.insertBefore(t,e),$(document.body).addClass('siac-left-right-switched'),pycmd('siac-switch-left-right true')):(e.parentNode.insertBefore(e,t),$(document.body).removeClass('siac-left-right-switched'),pycmd('siac-switch-left-right false'))},window.onWindowResize=function(e=!0){let t=byId('topbutsOuter')||document.querySelector('nav')||document.querySelector('.btn-toolbar'),i=t.offsetHeight+3,a=window.getComputedStyle(t).getPropertyValue('position');'fixed'===a&&(byId('outerWr').style.marginTop=i+'px'),byId('outerWr').style.height=`calc(100vh - ${i}px)`,e&&'undefined'!=typeof pdf.instance&&pdf.instance&&(this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){pdf.instance&&pdfFitToPage()},300))},window.setHighlighting=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('siac-toggle-highlight '+t)},window.setTagSearch=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('tagSearch '+t)},window.tagClick=function(e){if($(e).data('tags')&&$(e).data('tags')==$(e).data('name'))return $('#siac-modal').show(),void pycmd('siac-render-tags '+$(e).data('tags'));let t=$(e).data('target')||$(e).data('name');$('.siac-tag-info-box').remove(),$('#greyout').hide(),pycmd('siac-tag-clicked '+t)},window.noteSidebarExpandAll=function(){$('#siac-notes-sidebar .exp').each(function(e,i){let a=$(i);if(a.text().length&&'[+]'===a.text()){a.text('[-]'),a.parent().parent().children('ul').toggle();let e=i.dataset.t;1===_siacSidebar.tab?-1===_siacSidebar.addonTagsExpanded.indexOf(e)&&_siacSidebar.addonTagsExpanded.push(e):2===_siacSidebar.tab&&-1===_siacSidebar.ankiTagsExpanded.indexOf(e)&&_siacSidebar.ankiTagsExpanded.push(e)}})},window.noteSidebarCollapseAll=function(){$('#siac-notes-sidebar .exp').each(function(e,i){let a=$(i);if(a.text().length&&'[-]'===a.text()){a.text('[+]'),a.parent().parent().children('ul').toggle();let e=i.dataset.t;1===_siacSidebar.tab?-1!==_siacSidebar.addonTagsExpanded.indexOf(e)&&_siacSidebar.addonTagsExpanded.splice(_siacSidebar.addonTagsExpanded.indexOf(e),1):2===_siacSidebar.tab&&-1!==_siacSidebar.ankiTagsExpanded.indexOf(e)&&_siacSidebar.ankiTagsExpanded.splice(_siacSidebar.ankiTagsExpanded.indexOf(e),1)}})},window.deleteNote=function(e){byId('siac-del-modal').innerHTML='<center style="margin: 20px 0 20px 0;">Deleting...</center>',setTimeout(function(){pycmd('siac-delete-user-note '+e)},80)},window.synInputKeyup=function(e,t){13==e.keyCode&&t.value&&pycmd('siac-save-synonyms '+t.value)},window.synonymSetKeydown=function(e,t,i){13==e.keyCode&&t.innerHTML.length&&(pycmd('siac-edit-synonyms '+i+' '+t.innerHTML),e.preventDefault(),$(t).blur())},window.searchSynset=function(e){let t=e.parentElement.parentElement.children[0].children[0].innerHTML;t&&pycmd('siac-r-synset-search '+t)},window.updateFieldToExclude=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-exclude '+t+' '+i+' false'):pycmd('siac-update-field-to-exclude '+t+' '+i+' true')},window.updateFieldToHideInResult=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' false'):pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' true')},window.setSearchOnTyping=function(e,t=!0){SIAC.State.searchOnTyping=e,e?(SIAC.Fields.enableSearchOnTypingEventListener(),t&&sendContent()):SIAC.Fields.disableSearchOnTypingEventListener(),sendSearchOnTyping()},window.sendSearchOnTyping=function(){pycmd('siac-config-bool searchOnTyping '+SIAC.State.searchOnTyping)},window.sendSearchOnSelection=function(){pycmd('siac-config-bool searchOnSelection '+SIAC.State.searchOnSelection)},window.fieldKeypress=function(e){return 13==e.keyCode||9==e.keyCode||91==e.keyCode||37<=e.keyCode&&40>=e.keyCode||e.ctrlKey||e.altKey||(SIAC.State.timeout&&(clearTimeout(SIAC.State.timeout),SIAC.State.timeout=null),SIAC.State.timeout=setTimeout(function(){sendContent(e)},SIAC.State.typingDelay)),!0},window.searchMaskKeypress=function(e){13===e.keyCode&&sendSearchFieldContent()},window.pinCard=function(e){byId('siac-cnt-dsp-'+e).classList.toggle('hidden'),byId('siac-pin-dsp-'+e).classList.toggle('hidden');byId('siac-note-wr-'+e).classList.toggle('pinned');updatePinned()},window.searchCard=function(e){let t=byId('siac-inner-card-'+e).innerText;showLoading('Note Search'),pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+t)},window.searchCardFromFloated=function(e){let t=byId(e).innerHTML;showLoading('Note Search'),pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+t)},window.edit=function(e){pycmd('siac-edit-note '+e)},window.updatePinned=function(){let e='siac-pin';$('.pinned').each(function(){e+=' '+this.dataset.nid}),$('.noteFloating').each(function(){e+=' '+$(this).attr('id').substring(3)}),pycmd(e)},window.clearSearchResults=function(){let e=document.querySelectorAll('#searchResults .siac-note-outer:not(.pinned)');for(var t=0;t<e.length;t++)e[t].remove();try{byId('greyout').style.display='none'}catch(t){}$('.siac-tag-info-box,#siac-results-loader-wrapper').remove(),$('.tagLbl').css('z-index','999')},window.setSearchResults=function(e,t,a,n,s=1,d=1,o=50,l=-1,r=-1,c=!1,p=!1){let g=new Date().getTime();clearSearchResults();var f=byId('searchResults');f.style.overflowY='hidden',f.style.paddingRight='24px';let h='';if(e&&0<e.length){for(var u=0;u<e.length;u++)h+=`<div class='siac-note-outer mr-10 siac-results-header'>${e[u]}</div>`,u<e.length-1&&(h+='<div class=\'siac-note-outer mr-10 siac-results-header siac-results-header-between pl-10 pr-10\'><i class=\'fa fa-chevron-right\'></i></div>');byId('siac-results-header-wrapper').innerHTML=h,byId('siac-results-header-wrapper').style.display='flex'}else byId('siac-results-header-wrapper').style.display='none';if(f.innerHTML+=t,p||SIAC.State.keepPositionAtRendering||!(0<t.length)?SIAC.State.keepPositionAtRendering&&(SIAC.State.keepPositionAtRendering=!1):f.scrollTop=0,clearTimeout(SIAC.State.loadingTimer),n&&SIAC.State.lastHadResults&&byId('info-Took')?(byId('info-Took').innerHTML=n.Took,byId('info-Found').innerHTML=n.Found,byId('tagContainer').innerHTML=n.Tags,byId('keywordContainer').innerHTML=n.Keywords):byId('searchInfo').innerHTML=a,SIAC.State.lastHadResults=!!n,window.$searchInfo||(window.$searchInfo=byId('searchInfo')),$searchInfo.classList.contains('hidden')||($searchInfo.style.display='flex'),SIAC.State.gridView?$('#searchResults .cardWrapper').css('display','inline-block'):$('#searchResults .cardWrapper').show(),f.style.overflowY='auto',f.style.paddingRight='10px',byId('greyout').style.display='none',displayPagination(s,d,o,0<t.length,l),-1<r&&byId('info-took'))if(c){let e=new Date().getTime()-r;byId('info-Took').innerHTML=`<b>${e}</b> ms &nbsp;<b style='cursor: pointer' onclick='pycmd("siac-last-timing ${new Date().getTime()-g}")'><i class='fa fa-info-circle'></i></b>`}else byId('info-Took').innerHTML=`<b>${new Date().getTime()-r}</b> ms`;setTimeout(refreshMathJax,50)},window.displayPagination=function(n,s,a,d,o){if(-1!==o){let e='';if(1<o){e+=`<div onclick='pycmd("siac-rerender ${o-2}")' style='display: inline; cursor: pointer;'>Last Results: &nbsp;</div>`;for(var l=0;l<o-1;l++)e+=`<span onclick='pycmd("siac-rerender ${o-l-2}")'>${l+1}</span>`}byId('siac-cache-displ').innerHTML=e}let i='';if(0===s||!d)return byId('siac-pagination-status').innerHTML='',void(byId('siac-pagination-wrapper').innerHTML='');if(1===n&&1==s)i='';else{i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page 1")'>&#171;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${t(n-1,1)}")'>&#8249;</div>`;let d=0,a=0;n+5>s&&(d=n+5-s),0>=n-5&&(a=Math.abs(n-5)+1);for(var l=t(n-5-d,1);l<=n+5+a;l++)l==n?i+=`<div class='siac-pg-icn siac-pg-icn-active' onclick='pycmd("siac-page ${l}")'>${l}</div>`:l<=s&&(i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${l}")'>${l}</div>`);i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${e(n+1,s)}")'>&#8250;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${s}")'>&#187;</div>`}byId('siac-pagination-status').innerHTML=`Showing ${50*(n-1)+1} - ${e(a,50*n)} of ${a}`,byId('siac-pagination-wrapper').innerHTML=i},window.sendClickedInformation=function(e,t){let i=document.elementFromPoint(e,t);return'IMG'==i.tagName?'img '+i.src:('SPAN'==i.tagName||'DIV'==i.tagName||'MARK'==i.tagName)&&'siac-inner-card'==i.parentElement.className?'note '+i.parentElement.id+' '+i.parentElement.innerHTML:'siac-inner-card'==i.className?'note '+i.id+' '+i.innerHTML:void 0},window.toggleTooltip=function(e){$(e).children().first().toggle()},window.toggleFreeze=function(e){SIAC.State.isFrozen=!SIAC.State.isFrozen,$(e).toggleClass('frozen'),pycmd('siac-freeze '+SIAC.State.isFrozen)},window.toggleGrid=function(e){$(e).is(':checked')?(pycmd('toggleGrid on'),SIAC.State.gridView=!0):(pycmd('toggleGrid off'),SIAC.State.gridView=!1)},window.activateGridView=function(){SIAC.State.gridView=!0,window.setTimeout(function(){$('#gridCb').prop('checked',!0)},400)},window.predefSearch=function(t){if(!t||''===t){let i=byId('predefSearchSelect');t=i.options[i.selectedIndex].value}let e=byId('predefSearchNumberSel'),i=e.options[e.selectedIndex].value,a=SIAC.State.selectedDecks.toString();-1===['lowestPerf','highestPerf','highestRet','lowestRet'].indexOf(t)?pycmd('siac-predef-search '+t+' '+i+' '+a):(showSearchLoader('<i class=\'fa fa-spinner bold mb-10 fg-green\' style=\'font-size: 24px;\'></i><br>Computing ...'),setTimeout(function(){pycmd('siac-predef-search '+t+' '+i+' '+a)},250))},window.sort=function(){let t=byId('sortSelect'),e=t.options[t.selectedIndex].value;pycmd('siac-p-sort '+e)},window.toggleAddon=function(){500>document.body.offsetHeight||1e3>document.body.offsetWidth?document.body.classList.contains('siac-wm-both')?(document.body.classList.remove('siac-wm-both'),document.body.classList.add('siac-wm-addon')):document.body.classList.contains('siac-wm-addon')?(document.body.classList.remove('siac-wm-addon'),document.body.classList.add('siac-wm-both')):document.body.classList.contains('siac-wm-fields')&&(document.body.classList.remove('siac-wm-fields'),document.body.classList.add('siac-wm-both')):document.body.classList.contains('siac-wm-both')?(document.body.classList.remove('siac-wm-both'),document.body.classList.add('siac-wm-fields')):document.body.classList.contains('siac-wm-addon')?(document.body.classList.remove('siac-wm-addon'),document.body.classList.add('siac-wm-fields')):document.body.classList.contains('siac-wm-fields')&&(document.body.classList.remove('siac-wm-fields'),document.body.classList.add('siac-wm-both'));let e='Both';document.body.classList.contains('siac-wm-addon')?e='Addon':document.body.classList.contains('siac-wm-fields')&&(e='Fields'),pycmd('siac-window-mode '+e)},window.setWindowMode=function(e){if(document.body.classList.remove('siac-wm-fields'),document.body.classList.remove('siac-wm-addon'),document.body.classList.remove('siac-wm-both'),document.body.classList.remove('siac-wm-autohide'),document.body.classList.add('siac-wm-'+e.toLowerCase()),'Autohide'===e){let e=function(){return byId('siac-right-side')?void byId('siac-right-side').addEventListener('mousemove',addonMouseMove,!0):void setTimeout(e,100)};e()}else byId('siac-right-side')&&byId('siac-right-side').removeEventListener('mousemove',addonMouseMove,!0)},window.fieldsMouseEnter=function(e){document.body.classList.contains('siac-wm-autohide')&&!e.target.classList.contains('visible')&&(e.target.classList.add('visible'),displayedNoteId&&pdf.instance&&setTimeout(()=>{SIAC.Highlighting.displayHighlights(),byId('text-layer').style.left=activeCanvas().offsetLeft+'px'},50))},window.addonMouseMove=function(){clearTimeout(window._siac_move_timer),window._siac_move_timer=setTimeout(function(){$('#siac-right-side').is(':hover')&&byId('leftSide').classList.contains('visible')&&(byId('leftSide').classList.remove('visible'),displayedNoteId&&pdf.instance&&setTimeout(()=>{SIAC.Highlighting.displayHighlights(),byId('text-layer').style.left=activeCanvas().offsetLeft+'px'},50))},400)},window.removeNote=function(e){$('#siac-note-wr-'+e).remove(),updatePinned()},window.getOffset=function(e){for(var t=0,i=0;e&&'siac-right-side'!==e.id&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:i,left:t}},window.calBlockMouseEnter=function(e,t){SIAC.State.calTimer=setTimeout(function(){$('#cal-row').is(':hover')&&e.ctrlKey&&(displayCalInfo(t),SIAC.State.calTimer=null)},100)},window.displayCalInfo=function(e){let t=getOffset(e.children[0]),i=t.left-153,a=byId('siac-second-col-wrapper').clientWidth-t.left-153;0>i?(i-=t.left-153,document.documentElement.style.setProperty('--tleft',t.left+'px')):document.documentElement.style.setProperty('--tleft','50%'),0>a&&(document.documentElement.style.setProperty('--tleft',-a+153+'px'),i+=a),$('#cal-info').css('left',i+'px').css('top',t.top-275+'px'),byId('cal-info').style.display='block',pycmd('siac-cal-info '+$(e.children[0]).data('index'))},window.calMouseLeave=function(){SIAC.State.calTimer=setTimeout(function(){$('#cal-row').is(':hover')||$('#cal-info').is(':hover')||(byId('cal-info').style.display='none'),SIAC.State.calTimer=null},300)},window.fieldsBtnClicked=function(){if(SIAC.State.isFrozen)return void pycmd('siac-notification Results are frozen.');if(SIAC.Fields.empty())return void pycmd('siac-notification Fields are empty.');showLoading('Typing');let e=SIAC.Fields.getAllFieldsText();pycmd('siac-r-fld '+SIAC.State.selectedDecks.toString()+' ~ '+e)},window.showPDFLoader=function(){let e=pageSidebarDisplayed?230:0;byId('siac-reading-modal-center').innerHTML+=`
    <div id='siac-pdf-loader-wrapper'>
        <div class='siac-pdf-loader' style='margin-right: ${e}px'>
            <div style='margin-top: 7px;'> 
                <div style='margin-bottom: 12px;'><i class="fa fa-download" style='font-size: 25px; color: lightgrey;'></i></div>
                <div id='siac-pdf-loader-text'>Loading PDF file...</div>
            </div>
        </div>
    </div>`},window.showSearchLoader=function(e){if(!byId('siac-results-loader-wrapper')){let t=byId('searchResults');t.scrollTop=0,t.style.overflowY='hidden',$(t).append(`
    <div id='siac-results-loader-wrapper' style='position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 5; height: 100%; text-align: center; background: rgba(0,0,0,0.4); display:flex; align-items: center; justify-content: center; border-radius: 5px;'>
        <div class='siac-search-loader' style='display: inline-block; vertical-align: middle;'>
            <b>${e}</b>
        </div>
    </div>`)}},window.toggleSearchbarMode=function(e){'Mode: Browser'===e.innerHTML?(e.innerHTML='Mode: Add-on',pycmd('siac-searchbar-mode Add-on')):(e.innerHTML='Mode: Browser',pycmd('siac-searchbar-mode Browser'))},window.globalKeydown=function(t){if(displayedNoteId&&122===t.keyCode)toggleBothBars();else if((t.ctrlKey||t.metaKey)&&49<=t.keyCode&&57>=t.keyCode&&t.keyCode-48<=SIAC.Fields.count()&&windowHasSelection()&&!SIAC.Helpers.selectionIsInside(document.getElementById('leftSide'))){let e=selectionCleaned();e&&0<e.length&&SIAC.Fields.appendToFieldHtml(t.keyCode-49,e)}},window.toggleNoteSidebar=function(){byId('siac-notes-sidebar')?pycmd('siac-hide-note-sidebar'):pycmd('siac-show-note-sidebar')},window.focusSearchShortcut=function(){null===displayedNoteId&&byId('siac-browser-search-inp')&&byId('siac-browser-search-inp').focus()},window.triggerSearchShortcut=function(){displayedNoteId||sendContent()},window.addFloatingNote=function(e){let t=$('#'+e.toString()).hasClass('siac-user-note')?`pycmd("siac-edit-user-note ${e}")`:`edit(${e})`,i=byId('siac-inner-card-'+e).innerHTML;i=i.replace(/<\/?mark>/g,''),$('#siac-note-wr-'+e).remove();let a=`<div class='floatingBtnBar'>
        <div class="floatingBtnBarItem" onclick='${t}'>Edit</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" onclick='searchCardFromFloated("nFC-${e}")'>Search</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" id='rem-${e}' onclick='byId("nF-${e}").outerHTML = ""; updatePinned();'><span>&#10006;&nbsp;&nbsp;</span></div>
    </div>`,n=`<div id="nF-${e}" class='noteFloating'>
            <div id="nFH-${e}" class='noteFloatingHeader' onmousedown='dragElement(this.parentElement, "nFH-${e}")'>&nbsp;${a}</div>
            <div id="nFC-${e}" class='noteFloatingContent'  onmouseup='getSelectionText()' >${i}</div>
                </div>
            `;8<$('.field').length?$('.field').first().after(n):$('.field').last().after(n),dragElement(byId('nF-'+e),`nFH-${e}`),updatePinned()},window.dragElement=function(t,e,i=!1){function a(t){t=t||window.event,t.preventDefault(),l=t.clientX,r=t.clientY,document.onmouseup=s,document.onmousemove=n}function n(i){i=i||window.event,i.preventDefault(),d=l-i.clientX,o=r-i.clientY,l=i.clientX,r=i.clientY,t.style.top=t.offsetTop-o+'px',t.style.left=t.offsetLeft-d+'px'}function s(){document.onmouseup=null,document.onmousemove=null}var d=0,o=0,l=0,r=0;byId(e)?byId(e).onmousedown=a:t.onmousedown=a},window.drawHeatmap=function(e,t){if('undefined'==typeof CalHeatMap||'undefined'==typeof d3)return void setTimeout(()=>{drawHeatmap(e,t)},50);var i=new CalHeatMap;let a={min:'lightskyblue',max:'steelblue',empty:'#e1e1e1'};document.body.classList.contains('nightMode')&&(a={min:'#fed976',max:'#800026',empty:'rgb(110,110,110)'});let n='%B',s=byId('searchResults').offsetWidth;700>s&&(n='%b'),i.init({data:t,legendColors:a,itemName:['page','pages'],itemSelector:e,considerMissingDataAsZero:!0,dataType:'json',start:new Date(new Date().getFullYear(),0),maxDate:new Date,range:12,rowLimit:7,cellSize:11,cellPadding:2,domain:'month',domainLabelFormat:n,subDomain:'day'});let d=document.getElementsByClassName('cal-heatmap-container')[0];d.getBBox().width>s-100&&(d.style.zoom=s/(d.getBBox().width+120))},window.drawTopics=function(e,t){if('undefined'==typeof $||'undefined'==typeof $.plot)return void setTimeout(()=>{drawTopics(e,t)},200);let i={series:{pie:{show:!0,label:{show:!0},combine:{threshold:.02,label:'Others (< 2%)'},stroke:{color:document.body.classList.contains('nightMode')?'#ffffff':'transparent'}}},legend:{show:!1}};e&&0<e.length&&$.plot('#siac-read-stats-topics-pc_1',e.map((e)=>({label:e[0],data:e[1]})),i),t&&0<t.length&&$.plot('#siac-read-stats-topics-pc_2',t.map((e)=>({label:e[0],data:e[1]})),i)}},function(){window.SIAC.Helpers={calculateTextWidth:function(e,t){var i=this.calculateTextWidth.canvas||(this.calculateTextWidth.canvas=document.createElement('canvas')),a=i.getContext('2d');a.font=t;var n=a.measureText(e);return n.width},isAncestor:function(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1},selectionIsInside:function(e){let t=window.getSelection();if(0<t.rangeCount){for(var a=0;a<t.rangeCount;++a)if(!this.isAncestor(t.getRangeAt(a).commonAncestorContainer,e))return!1;return!0}return!1},getSelectionCoords:function(){let e=window.getSelection();if(e.rangeCount){$('#text-layer > span').css('height','auto');let i=e.getRangeAt(0),a=i.getClientRects(),n={top:-1,bottom:-1,left:-1,right:-1};for(var t=0;t<a.length;t++)(a[t].left<n.left||-1===n.left)&&(n.left=a[t].left),(a[t].top<n.top||-1===n.top)&&(n.top=a[t].top),(a[t].bottom>n.bottom||-1===n.bottom)&&(n.bottom=a[t].bottom),(a[t].right>n.right||-1===n.right)&&(n.right=a[t].right);return $('#text-layer > span').css('height','200px'),-1<n.top&&-1<n.bottom&&-1<n.left&&-1<n.right?{top:n.top,left:n.left,width:n.right-n.left,height:n.bottom-n.top}:null}return null},b64EncodeUnicode:function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode('0x'+t)}))},b64DecodeUnicode:function(e){return decodeURIComponent(atob(e).split('').map(function(e){return'%'+('00'+e.charCodeAt(0).toString(16)).slice(-2)}).join(''))}}},function(){var e=Math.min,a=Math.max;window.pdfSearchOngoing=!1,window.pdfCurrentSearch={query:null,lastStart:null,lastEnd:null,breakOnNext:null},window.onPDFSearchBtnClicked=function(e){$(e).hasClass('expanded')?$(e).find('input').focus():($(e).find('input').val(''),pdfCurrentSearch={query:null,lastEnd:null,lastStart:null})},window.onPDFSearchInput=function(e,t){13===t.keyCode&&e&&e.trim().length&&(readerNotification('Searching ...'),e.toLowerCase()!==pdfCurrentSearch.query&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=e.toLowerCase()),setTimeout(function(){nextPDFSearchResult()},10))},window.getContents=async function(e=1,t=1e4){for(var i,a=[],n=e;n<=pdf.instance.numPages&&n<=e+t;n++)i=pdf.instance.getPage(n),a.push(i.then(function(e){var t=e.hasOwnProperty('pageIndex')?e.pageIndex+1:e._pageIndex+1,a='',i=e.getTextContent();return i.then(function(e){for(var s=0;s<e.items.length;s++)a+=' '+e.items[s].str;return{page:t,text:a.toLowerCase()}})}));return Promise.all(a).then(function(e){return e})},window.resetSearch=function(){pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null},window.nextPDFSearchResult=async function(e='right'){if(!pdfSearchOngoing){let i=$('#siac-pdf-search-btn-inner input').first().val().toLowerCase();if(i&&0!==i.trim().length&&(null===pdfCurrentSearch.query?pdfCurrentSearch.query=i:(i!==pdfCurrentSearch.query||pdf.page!==pdfCurrentSearch.lastStart&&pdfCurrentSearch.lastStart===pdfCurrentSearch.lastEnd)&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=i),!!pdfCurrentSearch.query)){pdfCurrentSearch.breakOnNext=!1,pdfSearchOngoing=!0,greyoutBottom();var t=!1,a=!1,s=[...new Set(pdfCurrentSearch.query.toLowerCase().split(' '))].filter(function(e){return''!==e&&!/^[a-zA-Z0-9]$/.test(e)}).map(function(e){return e.replace(/[.,;-]$/,'')});if(0===s.length)return pdfSearchOngoing=!1,ungreyoutBottom(),void readerNotification('Query was empty after cleaning',!0);var d=0;do{d++;var o=getNextPagesToSearchIn(e);if('left'===e)var l=(await getContents(o.s,o.n)).reverse();else var l=await getContents(o.s,o.n);0===l.length&&(t=!0);for(var r=0;r<l.length&&!t;r++)for(var n=0;n<s.length;n++)if(-1!==l[r].text.indexOf(s[n])){pdf.page===l[r].page?readerNotification('Text found on current page',!0):readerNotification('Text found on page '+l[r].page,!0),pdf.page=l[r].page,queueRenderPage(pdf.page,!0,!1,!1,pdfCurrentSearch.query),pdfCurrentSearch.lastStart=pdf.page,pdfCurrentSearch.lastEnd=pdf.page,t=!0,a=!0;break}if(d>Math.round(pdf.instance.numPages/25)+2){readerNotification('Search aborted, took too long.',!0);break}}while(!t);a||(readerNotification('Text was not found.',!0),ungreyoutBottom()),pdfSearchOngoing=!1}}},window.getNextPagesToSearchIn=function(t){if(pdfCurrentSearch.breakOnNext)return[];let i=pdfCurrentSearch.lastStart,d=pdfCurrentSearch.lastEnd,o=25,l=-1,r=o;return'left'===t?(null===i?(l=a(pdf.page-o,1),r=e(o,pdf.page-l)):1===i?l=a(pdf.instance.numPages-o,1):d===i&&1!==d&&1<pdf.instance.numPages?(l=a(i-o-1,1),r=1===l?a(0,e(o,pdf.page-3)):e(o,pdf.page-l-1)):(l=a(i-o,1),1===l&&(r=a(0,i-2))),null!==i&&i>pdf.page&&l<=pdf.page?(l=pdf.page,pdfCurrentSearch.breakOnNext=!0):1===pdf.instance.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)):(null===i?(l=pdf.page,r=e(pdf.instance.numPages-l,o)):d===pdf.instance.numPages?(l=1,r=e(o,pdf.instance.numPages)):(l=d+1,r=e(pdf.instance.numPages-l,o)),null!==d&&d<pdf.page&&l+o>=pdf.page?(r=pdf.page-l,pdfCurrentSearch.breakOnNext=!0):null!==d&&d===pdf.instance.numPages&&1+o>=pdf.page?(r=pdf.page-l,pdfCurrentSearch.breakOnNext=!0):1===pdf.instance.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)),1===l&&pdf.instance.numPages<=r&&(pdfCurrentSearch.breakOnNext=!0),pdfCurrentSearch.lastStart=l,pdfCurrentSearch.lastEnd=e(pdf.instance.numPages,l+r),{s:l,n:r}},window.highlightPDFText=function(e,s=0){var n=byId('text-layer').querySelectorAll('span');if(0===n.length)return void(3>s&&setTimeout(function(){highlightPDFText(e,s+1)},200));let d=e.toLowerCase().split(' ');for(var o=0;o<d.length;o++)for(var i=0;i<n.length;i++)if(-1!==n[i].innerHTML.toLowerCase().indexOf(d[o])){var t=new RegExp(escapeRegExp(d[o]),'ig');n[i].innerHTML=n[i].innerHTML.replace(t,'<span class=\'tl-highlight\'>$&</span>')}byId('siac-pdf-top').scrollTop=a(0,$('#text-layer .tl-highlight').first()[0].parentElement.offsetTop-50)}},function(){var e=Math.trunc,t=Math.min,i=Math.abs,a=Math.max;window.pdfImgSel={canvas:null,context:null,startX:null,endX:null,startY:null,endY:null,cvsOffLeft:null,cvsOffTop:null,mouseIsDown:!1,canvasDispl:null},window.pdfImgMouseUp=function(){pdfImgSel.mouseIsDown&&(pdfImgSel.mouseIsDown=!1,drawSquare(),cropSelection(activeCanvas(),pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY,insertImage),$(pdfImgSel.canvas).remove(),$('#text-layer').show())},window.pageSnapshot=function(e){if(pdf.instance){let t=activeCanvas();cropSelection(t,0,0,t.offsetWidth,t.offsetHeight,function(t){insertImage(t,e)})}},window.extractPages=function(){pdf.instance&&(pycmd('siac-create-pdf-extract '+pdf.page+' '+pdf.instance.numPages),event.stopPropagation())},window.selectionSnapshot=function(i){let n=SIAC.Helpers.getSelectionCoords();if(n){let s=getSelection();s&&0<s.rangeCount&&s.getRangeAt(0).collapse(),byId('siac-pdf-tooltip')&&(byId('siac-pdf-tooltip').style.display='none'),setTimeout(function(){pycmd(`siac-screen-capture ${i} ${a(0,e(n.top-10))} ${a(0,e(n.left-10))} ${t(e(n.width+20),screen.width)} ${t(screen.height,e(n.height+20))}`)},50)}},window.cropSelection=function(e,t,i,a,n,s){if(!(2>a||2>n)){let d=document.createElement('canvas'),o=d.getContext('2d');d.width=a,d.height=n,o.drawImage(e,t*window.devicePixelRatio,i*window.devicePixelRatio,a*window.devicePixelRatio,n*window.devicePixelRatio,0,0,d.width,d.height),s(d.toDataURL())}},window.insertImage=function(e,t){null==t?pycmd('siac-add-image 1 '+e.replace('image/png','')):pycmd('siac-add-image-to-fld '+t+' '+e.replace('image/png',''))},window.pdfImgMouseDown=function(e){pdfImgSel.canvasDispl=activeCanvas().offsetLeft,pdfImgSel.mouseIsDown=!0,pdfImgSel.cvsOffLeft=$(pdfImgSel.canvas).offset().left,pdfImgSel.cvsOffTop=$(pdfImgSel.canvas).offset().top,pdfImgSel.startX=pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.startY=pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare()},window.initImageSelection=function(){if(pdf.instance){if($('#text-layer').is(':hidden'))return $(pdfImgSel.canvas).remove(),void $('#text-layer').show();disableAreaHighlight(),$('#text-layer').hide(),pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfImgMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e}},window.pdfImgMouseXY=function(e){pdfImgSel.mouseIsDown&&(pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare())},window.drawSquare=function(){pdfImgSel.context.clearRect(0,0,pdfImgSel.context.canvas.width,pdfImgSel.context.canvas.height),pdfImgSel.context.fillRect(pdfImgSel.startX*window.devicePixelRatio,pdfImgSel.startY*window.devicePixelRatio,i(pdfImgSel.startX-pdfImgSel.endX)*window.devicePixelRatio,i(pdfImgSel.startY-pdfImgSel.endY)*window.devicePixelRatio),pdfImgSel.context.fillStyle='yellow',pdfImgSel.context.fill()},window.clearImgSelectionCanvas=function(){if(pdfImgSel.canvas){let e=pdfImgSel.canvas.getContext('2d');e.clearRect(0,0,e.canvas.width,e.canvas.height)}},window.initAreaHighlight=function(){for(let e=document.getElementsByClassName('area_highlight_cv');e[0];)e[0].parentNode.removeChild(e[0]);pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');e.classList.add('area_highlight_cv'),e.oncontextmenu=disableAreaHighlight,pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfAreaHighlightMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e},window.disableAreaHighlight=function(){return pdfImgSel.canvas&&($(pdfImgSel.canvas).remove(),pdfImgSel.canvas=null),!1},window.pdfAreaHighlightMouseUp=function(){pdfImgSel.mouseIsDown&&(pdfImgSel.mouseIsDown=!1,drawSquare(),SIAC.Highlighting.createAreaHighlight(pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY),clearImgSelectionCanvas())}},function(){var e=Math.min;window.onPDFCopy=function(t){let e=selectionCleaned();e&&(t.clipboardData.setData('text/plain',e),t.preventDefault())},window.selectionCleaned=function(){let t=getSelection(),i=t.getRangeAt(0),a=nodesInSelection(i);if(!a||1===a.length)return t.toString();let n='',s=0,d=0,o=0,l=0,r=[],c=null;for(let e=0;e<a.length;e++){(a[e].offsetLeft<s||a[e].offsetTop>d+5)&&!a[e].innerText.startsWith(' ')?(c&&4<Math.abs(+a[e].style.fontSize.substring(0,a[e].style.fontSize.indexOf('px'))-c)?(n+='\n\n'+a[e].innerText,l+=2):0<r.length&&a[e].offsetTop-d>r.slice(-1)[0]+2?(n+='\n\n'+a[e].innerText,l+=2):n.endsWith('-')?(n=n.substring(0,n.length-1)+a[e].innerText,l--):(n+=' '+a[e].innerText,l++),0!==d&&r.push(a[e].offsetTop-d),c=+a[e].style.fontSize.substring(0,a[e].style.fontSize.indexOf('px'))):s+o<a[e].offsetLeft-2&&!a[e].innerText.startsWith(' ')?(n+=' '+a[e].innerText,l++):s+o>a[e].offsetLeft-5?n=n.trimRight()+a[e].innerText:n+=a[e].innerText,s=a[e].offsetLeft,d=a[e].offsetTop;let t=(a[e].style.fontWeight||'normal')+' '+a[e].style.fontSize+' '+a[e].style.fontFamily;a[e].offsetWidth;let i=/[0-9]+(\.[0-9]+)?/g.exec(a[e].style.transform)?+/[0-9]+(\.[0-9]+)?/g.exec(a[e].style.transform)[0]:1;o=SIAC.Helpers.calculateTextWidth(a[e].innerText.trim(),t)*i}let p=t.toString();if(!n.length&&p.length&&(n=p),n=n.replace('  ',' '),!p.startsWith(n.substring(0,e(10,n.length))))for(var g=10;0<g;g--)if(0<n.indexOf(p.substring(0,e(g,p.length)))){n=n.substring(n.indexOf(p.substring(0,e(g,p.length))));break}if(n.length>p.length+l)for(var f=10;0<f;f--){let t=p.substring(p.length-e(p.length,f));if(0<=n.lastIndexOf(t)){n=n.substring(0,n.lastIndexOf(t)+t.length);break}}return n=n.replace(/( |&nbsp;){2,}/g,' '),n=n.replace(/ ([,.;:]) /g,'$1 '),n=n.replace(/ ([)\].!?:])/g,'$1'),n=n.replace(/([(\[]) /g,'$1'),n},window.pdfLeftTabPdfSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-pdf-search '+e)},window.pdfLeftTabAnkiSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-anki-search '+e)},window.initAreaHighlightShortcutPressed=function(){pdf.instance&&!iframeIsDisplayed&&0<SIAC.Highlighting.colorSelected.id&&(readerNotification('&nbsp;Area Highlight&nbsp;'),initAreaHighlight(),pdf.textLayerMetaKey=!1)},window.pdfTooltipClozeKeyup=function(e){try{if(e.ctrlKey&&e.shiftKey&&67===e.keyCode){let e=window.getSelection().toString();if(!e||0===e.length)return;let i=byId('siac-pdf-tooltip-results-area').innerHTML;for(var t=1;20>t;t++)if(-1===i.indexOf('{{c'+t+'::')){i=i.split(e).join('<span style=\'color: lightblue;\'>{{c'+t+'::'+e+'}}</span>'),byId('siac-pdf-tooltip-results-area').innerHTML=i;break}}}catch(e){pycmd('siac-notification Something went wrong during clozing:<br> '+e.message)}},window.markClicked=function(e){'siac-page-mark-link'===e.target.className&&(pdf.page=+e.target.innerHTML,queueRenderPage(pdf.page,!0))},window.iframeBtnClicked=function(e){e.preventDefault(),$(e.target).toggleClass('expanded'),e.stopPropagation(),$(e.target).hasClass('expanded')&&$(e.target).find('input').first().focus()},window.textlayerClicked=function(t,i){if(!t.ctrlKey&&!windowHasSelection()&&($('#siac-pdf-tooltip').hide(),'none'!==i.style.pointerEvents)){i.style.pointerEvents='none';let a=$.Event('click');a.ctrlKey=!0,$(document.elementFromPoint(t.clientX,t.clientY)).trigger(a),i.style.pointerEvents='auto'}},window.pdfKeyup=function(t){t&&(!t.ctrlKey&&!t.metaKey&&pdf.tooltip.enabled&&windowHasSelection()?pdfTooltip(t):(t.ctrlKey||t.metaKey)&&0<SIAC.Highlighting.colorSelected.id&&windowHasSelection()?(SIAC.Highlighting.highlight(),pdf.textLayerMetaKey=!1):(t.ctrlKey||t.metaKey)&&0===SIAC.Highlighting.colorSelected.id&&!windowHasSelection()&&SIAC.Highlighting.insertText(t))},window.pdfTooltip=function(){$('#text-layer .tl-highlight').remove();let e=window.getSelection(),t=e.getRangeAt(0),i=e.toString();if(0===i.trim().length||500<i.length)return;$('#text-layer > span').css('height','auto');let a=nodesInSelection(t),n=getSentencesAroundSelection(t,a,i);i=selectionCleaned();let s=t.getBoundingClientRect(),d=byId('siac-reading-modal').getBoundingClientRect(),o=s.left-d.left;250>d.width-o&&(o-=200);let l=s.top-d.top+s.height;0>l||(pdf.tooltip.sentences=n,pdf.tooltip.selection=i,pdf.tooltip.top=l,pdf.tooltip.left=o,renderTooltip(n,i,l,o),$('#text-layer > span').css('height','200px'))},window.renderTooltip=function(e,t,i,a){byId('siac-pdf-tooltip').innerHTML='<center>Searching...</center>',$('#siac-pdf-tooltip').css({top:i+'px',left:a+'px',display:'flex'}),pycmd('siac-pdf-selection '+t),$('#siac-pdf-tooltip').data({sentences:e,selection:t,top:i})},window.pdfMouseWheel=function(e){(e.ctrlKey||e.metaKey)&&(0>e.deltaY?pdfScaleChange('up'):0<e.deltaY&&pdfScaleChange('down'),e.preventDefault())},window.onTextSelectionChange=function(){setTimeout(function(){windowHasSelection()&&!SIAC.Helpers.selectionIsInside(document.getElementById('leftSide'))?SIAC.Fields.displaySelectionMenu():SIAC.Fields.hideSelectionMenu()},50)}},function(){var e=Math.floor;if(window.tomato={remainingSeconds:1800,readingTimer:null,lastStart:30},window.pdf={instance:null,displayedViewPort:null,pageRendering:!1,page:null,displayedScale:2,highDPIWasUsed:!1,pageNumPending:null,latestRenderTimestamp:null,TOC:null,pagesRead:[],extract:null,extractExclude:null,displayedMarks:null,displayedMarksTable:null,lastReadPages:{},fullScreen:!1,textLayerMetaKey:!1,linksEnabled:!1,notification:{queue:[],current:''},tooltip:{enabled:!0}},window.noteLoading=!1,window.pdfLoading=!1,window.modalShown=!1,window.iframeIsDisplayed=!1,window.pageSidebarDisplayed=!0,window.displayedNoteId=null,window.bottomBarTabDisplayed='marks',window.textEditor=null,'undefined'==typeof t)var t=window;window.activeCanvas=function(){let e=byId('siac-pdf-canvas');return e?'none'===e.style.display?byId('siac-pdf-canvas_1'):e:null},window.checkTOC=function(){if(!pdf.instance)return;let e=pdf.instance;e.getOutline().then(function(t){if(!t||0===t.length)return Promise.reject();let i=t[0].dest;Array.isArray(i)?e.getPageIndex(i[0]).catch((t)=>(console.log(t),Promise.reject())).then(function(e){null!=e&&(byId('siac-toc-btn').style.display='block')}):e.getDestination(i).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){null!=e&&(byId('siac-toc-btn').style.display='block')})})},window.loadTOC=function(){if(!pdf.instance)return;let e=pdf.instance;pdf.TOC&&0<pdf.TOC.length||(window.pdf.TOC=[],e.getOutline().then(function(t){if(t){let a=[];for(let n,s=0;s<t.length;s++){n=t[s].dest;const i=t[s].title;if(Array.isArray(n)?a.push(e.getPageIndex(n[0]).catch((t)=>(console.log(t),Promise.resolve())).then(function(e){if(null!=e)return window.pdf.TOC.push({title:i,page:parseInt(e)+1}),Promise.resolve()})):a.push(e.getDestination(n).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){return window.pdf.TOC.push({title:i,page:parseInt(e)+1}),Promise.resolve()})),t[s].items&&0<t[s].items.length){let i=t[s].items;for(let t=0;t<i.length;t++){let n=i[t].dest,d=i[t].title;Array.isArray(n)?a.push(e.getPageIndex(n[0]).catch((t)=>(console.log(t),Promise.resolve())).then(function(e){if(null!=e)return window.pdf.TOC[s].children||(window.pdf.TOC[s].children=[]),window.pdf.TOC[s].children.push({title:d,page:parseInt(e)+1}),Promise.resolve()})):a.push(e.getDestination(n).then(function(e){if(!e)return null;const t=e[0];return t}).then(e.getPageIndex.bind(e)).then(function(e){return window.pdf.TOC[s].children||(window.pdf.TOC[s].children=[]),window.pdf.TOC[s].children.push({title:d,page:parseInt(e)+1}),Promise.resolve()}))}}}return Promise.all(a)}}).then(function(){let e='<ul style=\'margin-top: 0;\'>';if(pdf.TOC&&pdf.TOC.length){for(var t=0;t<pdf.TOC.length;t++){if(e+=`<li class='siac-toc-item blue-hover' onclick='pdfGotoPg(${pdf.TOC[t].page})'><div><div>${pdf.TOC[t].page}:</div><div class='siac_toc_title'>${pdf.TOC[t].title||'&lt;Untitled&gt;'}</div></div>`,pdf.TOC[t].children&&0<pdf.TOC[t].children.length){e+=`<ul>`;for(var i=0;i<pdf.TOC[t].children.length;i++){let a=pdf.TOC[t].children[i];e+=`<li class='siac-toc-item blue-hover' onclick='pdfGotoPg(${a.page})'><div><div>${a.page}:</div><div class='siac_toc_title'>${a.title||'&lt;Untitled&gt;'}</div></div></li>`}e+='</ul>'}e+='</li>'}e=`<div class='ta_center siac-note-header mb-10'><b style='font-size: 14px;'>Table of Contents</b></div>
                    <div style='overflow: auto;' class='p-10 fg_lightgrey'>${e}</div>`}byId('siac-toc').innerHTML=e}))},window.tocBtnClicked=function(){noteLoading||pdfLoading||($('#siac-toc').is(':visible')?byId('siac-toc').style.display='none':(byId('siac-toc').style.display='flex',loadTOC()),pdfFitToPage())},window.pdfFitToPage=function(){iframeIsDisplayed||renderPDFPage(pdf.page,!1,!0,!1,'',!1)},window.queueRenderPage=function(e,t=!0,i=!1,a=!1,n='',s=!0){pdf.pageRendering?pdf.pageNumPending=e:renderPDFPage(e,t,i,a,n,s)},window.setupAnnotations=function(e,t,i,a){var n=$(i).offset(),s=e.getAnnotations().then(function(s){t=t.clone({dontFlip:!0}),a.children().remove();for(var d=.001,o=0;o<s.length;o++){var i=s[o],l=i.rect,r=l[2]-l[0],c=l[3]-l[1],p=r*c;p>d&&(d=p)}for(var o=0;o<s.length;o++){var i=s[o],l=i.rect,r=l[2]-l[0],c=l[3]-l[1],p=r*c,g=p/d;if('Link'===i.subtype&&i.url){var f=$('<a>').attr('href',i.url).get(0),l=i.rect,h=e.view;l=pdfjsLib.Util.normalizeRect([l[0],h[3]-l[1]+h[1],l[2],h[3]-l[3]+h[1]]);var r=l[2]-l[0],c=l[3]-l[1],p=r*c;f.style.left=12+n.left+l[0]+'px',f.style.top=n.top+l[1]+'px',f.style.width=r+'px',f.style.height=c+'px',f.style.position='absolute',f.style.zIndex=12-Math.round(8*g);var u=t.transform,m='matrix('+u.join(',')+')';f.style.transform=m;var y=-l[0]+'px '+-l[1]+'px';f.style.transformOrigin=y,a.append(f)}}});return s},window.refreshPDFPage=function(){renderPDFPage(pdf.page,!1,!1,!1,'',!0)},window.renderPDFPage=function(e,t=!0,i=!1,a=!1,n='',s=!0){!pdf.instance||iframeIsDisplayed||(byId('siac-pdf-tooltip').style.display='none',pdfLoading=!0,a&&pdfLoaderText('Initializing Reader...'),pdf.instance.getPage(e).then(function(d){pdf.pageRendering=!0;var o=new Date().getTime();pdf.latestRenderTimestamp=o;var l=pdf_canvas_0;if('none'!==l.style.display&&(l=pdf_canvas_1),i){var r=d.getViewport({scale:1});pdf.displayedScale=(l.parentNode.clientWidth-23)/r.width}var r=d.getViewport({scale:pdf.displayedScale});l.height=r.height*window.devicePixelRatio,l.width=r.width*window.devicePixelRatio,(1!==window.devicePixelRatio||pdf.highDPIWasUsed)&&(pdf.highDPIWasUsed=!0,l.style.height=r.height+'px',l.style.width=r.width+'px');var c=l.getContext('2d'),p=d.render({canvasContext:c,viewport:r,transform:1===window.devicePixelRatio?null:[window.devicePixelRatio,0,0,window.devicePixelRatio,0,0]});return null===pdf.pageNumPending?void p.promise.then(function(){return(pdf.linksEnabled&&setupAnnotations(d,r,l,$('.annotationLayer')),byId('siac-pdf-page-lbl').innerHTML=`${pdf.page} / ${pdf.instance.numPages}`,pdf.pageRendering=!1,null!==pdf.pageNumPending)?(renderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,Promise.reject()):(t&&(l.parentElement.scrollTop=0),'siac-pdf-canvas'===l.id?pdf_canvas_1.style.display='none':pdf_canvas_0.style.display='none',l.style.display='inline-block',SIAC.Highlighting.removeAllHighlights(),s&&updatePdfDisplayedMarks(!0),SIAC.Colors.shouldChangeColors()&&SIAC.Colors.invertCanvas(c),d.getTextContent({normalizeWhitespace:!1,disableCombineTextItems:!1}))}).catch(function(){return Promise.reject()}).then(function(d){return!d||pdf.pageRendering?Promise.reject():pdf.pageNumPending?(renderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,null):void($('#text-layer').css({height:l.height/window.devicePixelRatio,width:l.width/window.devicePixelRatio+1,left:l.offsetLeft}).html(''),pdfjsLib.renderTextLayer({textContent:d,container:byId('text-layer'),viewport:r,textDivs:[]}),n?highlightPDFText(n):resetSearch(),pdfLoading=!1,(a||n)&&ungreyoutBottom(),a&&$('#siac-pdf-loader-wrapper').remove(),pdf.displayedViewPort=r,s?(SIAC.Highlighting.current=[],pycmd('siac-pdf-page-loaded '+pdf.page)):SIAC.Highlighting.displayHighlights(),!pdf.pageNumPending&&!pdf.pageRendering&&(-1===pdf.pagesRead.indexOf(e)?(byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book"></i><b>&nbsp; Read</b>'):(byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book"></i><b>&nbsp; Unread</b>'),s&&(pdf.extract&&0<pdf.extract.length&&(pdf.extract[0]>pdf.page||pdf.extract[1]<pdf.page)?$('#siac-pdf-top').addClass('extract'):0<pdf.extractExclude.length?pdf.extractExclude.find((e)=>e[0]<=pdf.page&&e[1]>=pdf.page)?$('#siac-pdf-top').addClass('extract'):$('#siac-pdf-top').removeClass('extract'):$('#siac-pdf-top').removeClass('extract')),s&&pageSidebarDisplayed&&pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`),setLastReadPage()))}):(renderPDFPage(pdf.pageNumPending,t,i,a,n,s),pdf.pageNumPending=null,Promise.reject())}).catch(function(e){setTimeout(function(){console.log(e)})}))},window.pdfPageRight=function(){!pdf.instance||iframeIsDisplayed||pdf.page<pdf.instance.numPages&&(pdf.page++,queueRenderPage(pdf.page))},window.pdfPageLeft=function(){!pdf.instance||iframeIsDisplayed||1<pdf.page&&(pdf.page--,queueRenderPage(pdf.page))},window.pdfToggleReadAndPageRight=function(){!pdf.instance||iframeIsDisplayed||(pdf.instance&&-1===pdf.pagesRead.indexOf(pdf.page)&&(!pdf.extract||pdf.extract[0]<=pdf.page&&pdf.extract[1]>=pdf.page)&&(pycmd('siac-pdf-page-read '+$('#siac-pdf-top').data('pdfid')+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.length?pdf.pagesRead.push(pdf.page):pdf.pagesRead=[pdf.page],updatePdfProgressBar()),pdfPageRight())},window.togglePageRead=function(e){!pdf.instance||pdf.extract&&(pdf.page<pdf.extract[0]||pdf.page>pdf.extract[1])||(!e&&(e=displayedNoteId),-1===pdf.pagesRead.indexOf(pdf.page)?(byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i><b>&nbsp; Unread</b>',pycmd('siac-pdf-page-read '+e+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.length?pdf.pagesRead.push(pdf.page):pdf.pagesRead=[pdf.page]):(byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i><b>&nbsp; Read</b>',pycmd('siac-pdf-page-unread '+e+' '+pdf.page+' '+numPagesExtract()),pdf.pagesRead.splice(pdf.pagesRead.indexOf(pdf.page),1)),updatePdfProgressBar())},window.pdfHidePageReadMark=function(){byId('siac-pdf-overlay').style.display='none',byId('siac-pdf-read-btn').innerHTML='\u2713<b>&nbsp; Read</b>'},window.pdfShowPageReadMark=function(){byId('siac-pdf-overlay').style.display='block',byId('siac-pdf-read-btn').innerHTML='&times;<b> Unread</b>'},window.pdfJumpToPage=function(t,e){if(13!==t.keyCode)return;let i=e.value;i=Math.min(pdf.instance.numPages,i),pdf.page=i,queueRenderPage(pdf.page)},window.pdfScaleChange=function(e){'up'===e?pdf.displayedScale+=.1:(pdf.displayedScale-=.1,pdf.displayedScale=Math.max(.1,pdf.displayedScale)),queueRenderPage(pdf.page,!1,!1,!1,'',!1)},window.setAllPagesRead=function(){if(!pdf.extract)pdf.pagesRead=Array.from(Array(pdf.instance.numPages).keys()).map((e)=>++e);else{pdf.pagesRead=[];for(var e=pdf.extract[0];e<=pdf.extract[1];e++)pdf.pagesRead.push(e)}-1!==pdf.pagesRead.indexOf(pdf.page)&&pdfShowPageReadMark()},window.setLastReadPage=function(){pdf.lastReadPages[displayedNoteId]=pdf.page},window.getLastReadPage=function(){return displayedNoteId&&displayedNoteId in pdf.lastReadPages?pdf.lastReadPages[displayedNoteId]:null},window.updatePdfProgressBar=function(){let t=e(10*pdf.pagesRead.length/numPagesExtract()),i=`<span style='margin-right: 10px; display: inline-block; min-width: 35px; font-weight: bold; color: lightgrey;'>${Math.trunc(100*pdf.pagesRead.length/numPagesExtract())} %</span>`;for(var a=0;10>a;a++)i+=a<t?`<div class='siac-prog-sq-filled'></div>`:`<div class='siac-prog-sq'></div>`;byId('siac-prog-bar-wr').innerHTML=i,'pages'===bottomBarTabDisplayed&&pycmd(`siac-pdf-show-bottom-tab ${displayedNoteId} pages`)},window.numPagesExtract=function(){return pdf.extract?pdf.extract[1]-pdf.extract[0]+1:pdf.instance.numPages},window.markReadUpToCurrent=function(){for(var e=0;e<pdf.page;e++)-1===pdf.pagesRead.indexOf(e+1)&&(!pdf.extract||e+1>=pdf.extract[0]&&e+1<=pdf.extract[1])&&pdf.pagesRead.push(e+1);-1!==pdf.pagesRead.indexOf(pdf.page)&&pdfShowPageReadMark()},window._startTimer=function(){tomato.readingTimer&&clearInterval(tomato.readingTimer),tomato.readingTimer=setInterval(function(){if(tomato.remainingSeconds--,$('.siac-reading-modal-timer-lbl').text(e(tomato.remainingSeconds/60)+' : '+(10>tomato.remainingSeconds%60?'0'+tomato.remainingSeconds%60:tomato.remainingSeconds%60)),0>=tomato.remainingSeconds){clearInterval(tomato.readingTimer),tomato.remainingSeconds=60*tomato.lastStart,$('.siac-timer-play-btn').html('<i class=\'fa fa-play mr-5\'></i><b>Start</b>').addClass('inactive'),setTimerActive(tomato.lastStart);let t=tomato.remainingSeconds;$('.siac-reading-modal-timer-lbl').text(e(t/60)+' : '+(10>t%60?'0'+t%60:t%60)),pycmd('siac-timer-elapsed'),tomato.readingTimer=null}},999)},window.toggleTimer=function(){$('.siac-timer-play-btn').first().hasClass('inactive')?($('.siac-timer-play-btn').removeClass('inactive'),$('.siac-timer-play-btn').html('<i class=\'fa fa-pause mr-5\'></i><b>Pause</b>'),_startTimer()):(clearInterval(tomato.readingTimer),tomato.readingTimer=null,$('.siac-timer-play-btn').addClass('inactive'),$('.siac-timer-play-btn').html('<i class=\'fa fa-play mr-5\'></i><b>Start</b>'))},window.resetTimer=function(t){clearInterval(tomato.readingTimer),tomato.readingTimer=null,$('.siac-timer-btn').removeClass('active');let i=+t.innerHTML;$('.siac-timer-btn.'+i).addClass('active'),tomato.remainingSeconds=60*i,tomato.lastStart=i;let a=tomato.remainingSeconds;$('.siac-reading-modal-timer-lbl').text(e(a/60)+' : '+(10>a%60?'0'+a%60:a%60)),$('.siac-timer-play-btn').addClass('inactive').html('<i class=\'fa fa-play mr-5\'></i><b>Start</b>')},window.startTimer=function(e){resetTimer($('.siac-timer-btn.'+e).get(0)),$('.siac-timer-play-btn').first().trigger('click')},window.setTimerActive=function(e){$('.siac-timer-btn').removeClass('active'),$('.siac-timer-btn.'+e).addClass('active')},window.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')},window.readerNotification=function(e,t){if(e){if(!t&&''!=pdf.notification.current){if(0<pdf.notification.queue.length){if(e===pdf.notification.queue[pdf.notification.queue.length-1])return;}else if(pdf.notification.current===e)return;return void pdf.notification.queue.push(e)}pdf.notification.current=e,byId('siac-pdf-br-notify').innerHTML=e,byId('siac-pdf-br-notify').style.display='block',window.setTimeout(()=>{pdf.notification.current='',byId('siac-pdf-br-notify')?(byId('siac-pdf-br-notify').style.display='none',pdf.notification.queue.length&&setTimeout(function(){let e=pdf.notification.queue.shift();readerNotification(e,!0)},800)):pdf.notification.queue=[]},3500)}},window.swapReadingModal=function(){let e=byId('siac-reading-modal');'siac-right-side'===e.parentNode.id?byId('leftSide').appendChild(e):byId('siac-right-side').appendChild(e)},window.updatePdfDisplayedMarks=function(e){if(null!=pdf.displayedMarks){if(e){let e='';if($('.siac-mark-btn-inner').removeClass('active'),pdf.page in pdf.displayedMarks){let i='<div class=\'siac-pdf-mark-lbl\'><span><i class=\'fa fa-star\'></i>&nbsp; -1 &nbsp;</span><b onclick=\'$(".siac-mark-btn-inner--2").trigger("click");\'>&times</b></div>';for(var t=0;t<pdf.displayedMarks[pdf.page].length;t++)switch(pdf.displayedMarks[pdf.page][t]){case 1:e+=i.replace('-1','Revisit').replace('-2','1'),$('.siac-mark-btn-inner-1').first().addClass('active');break;case 2:e+=i.replace('-1','Hard').replace('-2','2'),$('.siac-mark-btn-inner-2').first().addClass('active');break;case 3:e+=i.replace('-1','More Info').replace('-2','3'),$('.siac-mark-btn-inner-3').first().addClass('active');break;case 4:e+=i.replace('-1','More Cards').replace('-2','4'),$('.siac-mark-btn-inner-4').first().addClass('active');break;case 5:e+=i.replace('-1','Bookmark').replace('-2','5'),$('.siac-mark-btn-inner-5').first().addClass('active');}}byId('siac-pdf-overlay-top-lbl-wrap')&&(byId('siac-pdf-overlay-top-lbl-wrap').innerHTML=e)}let i=byId('siac-queue-readings-list').offsetWidth,n=byId('siac-queue-actions').offsetWidth,s=byId('siac-reading-modal-bottom-bar').clientWidth-i-n-100;var a='';Object.keys(pdf.displayedMarksTable).forEach(function(e){let t='';'1'===e?t='Revisit':'2'===e?t='Hard':'3'===e?t='More Info':'4'===e?t='More Cards':'5'===e?t='Bookmark':void 0;let n='';for(var s=0;s<pdf.displayedMarksTable[e].length;s++)n+='<span class=\'siac-page-mark-link\'>'+pdf.displayedMarksTable[e][s]+'</span>, ';n=0<n.length?n.substring(0,n.length-2):n,a+=`<tr style='color: grey;'><td><b>${t}</b></td><td>${n}</td></tr>`}),a.length&&(a=`<table style='user-select: none; table-layout: fixed; max-width: ${s}px;'>`+a+'</table>'),byId('siac-marks-display')&&(a.length?byId('siac-marks-display').innerHTML=a:byId('siac-marks-display').innerHTML=`<div style='display: flex; flex-direction: column; justify-content: center; height: 100%; width: 100%; text-align: center; color: grey;'>
                    <div class='siac-caps'><i class="fa fa-star-o"></i>&nbsp; No marks</div>
                </div>`),onMarkBtnClicked(byId('siac-mark-jump-btn'))}},window.doneShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||$('#siac-first-in-queue-btn').trigger('click')},window.laterShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||!byId('siac-later-btn')||$('#siac-later-btn').trigger('click')},window.jumpLastPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=pdf.instance.numPages,queueRenderPage(pdf.page,!0))},window.jumpFirstPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=1,queueRenderPage(1,!0))},window.pdfGotoPg=function(e){pdfLoading||noteLoading||modalShown||!pdf.instance||(pdf.page=e,queueRenderPage(e,!0))},window.togglePDFLinks=function(e){e||(e=byId('siac-pdf-links-toggle')),e&&(pdf.linksEnabled=!pdf.linksEnabled,pdf.linksEnabled?($(e).addClass('active'),$('.annotationLayer').show(),readerNotification('PDF Links enabled.',!0)):($(e).removeClass('active'),$('.annotationLayer').hide(),readerNotification('PDF Links disabled.',!0)),refreshPDFPage())},window.togglePDFSelect=function(e){e||(e=byId('siac-pdf-tooltip-toggle')),e&&(pdf.tooltip.enabled=!pdf.tooltip.enabled,pycmd('siac-config-bool pdf.tooltip_enabled '+pdf.tooltip.enabled.toString()),pdf.tooltip.enabled?($(e).addClass('active'),readerNotification('Search on select enabled.',!0)):($(e).removeClass('active'),$('#siac-pdf-tooltip').hide(),readerNotification('Search on select disabled.',!0)))},window.onMarkBtnClicked=function(e){$(e).hasClass('expanded')&&(pdf.displayedMarks&&0<Object.keys(pdf.displayedMarks).length?byId('siac-mark-jump-btn-inner').innerHTML='<b onclick=\'event.stopPropagation(); jumpToNextMark();\' style=\'vertical-align: middle;\'>Jump to Next Mark</b>':byId('siac-mark-jump-btn-inner').innerHTML='<b style=\'vertical-align:middle; color: grey;\'>No Marks in PDF</b>')},window.jumpToNextMark=function(){if(pdf.instance){let t=Object.keys(pdf.displayedMarks);for(var e=0;e<t.length;e++)if(+t[e]>pdf.page)return pdf.page=+t[e],void queueRenderPage(pdf.page,!0,!1,!1);pdf.page=+t[0],queueRenderPage(pdf.page,!0,!1,!1)}},window.bringPDFIntoView=function(){document.body.classList.contains('siac-wm-fields')&&pycmd('siac-window-mode Addon')},window.beforeNoteQuickOpen=function(){return!(noteLoading||pdfLoading||modalShown)&&(pdf.instance&&(noteLoading=!0,greyoutBottom(),destroyPDF()),bringPDFIntoView(),!0)},window.pdfTooltipBack=function(){pdf.tooltip&&renderTooltip(pdf.tooltip.sentences,pdf.tooltip.selection,pdf.tooltip.top,pdf.tooltip.left)},window.centerTooltip=function(){let e=$('#siac-pdf-top').width(),t=$('#siac-pdf-top').height(),i=$('#siac-pdf-tooltip');byId('siac-pdf-tooltip-results-area').style.removeProperty('max-height'),byId('siac-pdf-tooltip').style.removeProperty('max-width');let a=t/2-i.height()/2,n=e/2-i.width()/2;i.css({top:a,left:n}),pdf.tooltip.top=a,pdf.tooltip.left=n},window.destroyPDF=function(){pdf.instance&&pdf.instance.destroy(),pdf.instance=null},window.pdfUrlSearch=function(e){if(!e.length)return;let t='';$('#siac-iframe-btn tr').each(function(){$(this.children[1].children[0]).is(':checked')&&(t=$(this.children[1].children[0]).data('url'))}),pycmd('siac-url-srch $$$'+e+'$$$'+t),$('#siac-iframe-btn').removeClass('expanded')},window.showQueueInfobox=function(e,t){pdfLoading||noteLoading||modalShown||(pycmd('siac-queue-info '+t),document.documentElement.style.setProperty('--ttop',e.offsetTop+'px'),pdfLoading||noteLoading||modalShown)},window.leaveQueueItem=function(){window.setTimeout(function(){$('#siac-queue-infobox').is(':hover')||$('#siac-queue-readings-list .siac-link-btn:hover').length||hideQueueInfobox()},400)},window.hideQueueInfobox=function(){byId('siac-queue-infobox')&&(byId('siac-queue-infobox').style.display='none',byId('siac-pdf-bottom-tabs').style.visibility='visible')},window.greyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-link-btn,#siac-reading-modal-bottom-bar .fa,.siac-bb-btn,.siac-prio-lbl,.siac-queue-btn,#siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').addClass('siac-disabled')},window.ungreyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-link-btn,#siac-reading-modal-bottom-bar .fa,.siac-bb-btn,.siac-prio-lbl,.siac-queue-btn, #siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').removeClass('siac-disabled')},window.unhideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-unhide-pdf-queue '+e)},window.hideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-hide-pdf-queue '+e)},window.toggleBottomBar=function(){byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')?(byId('siac-reading-modal-bottom-bar').classList.remove('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar false')):(byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true'))},window.toggleTopBar=function(){byId('siac-reading-modal-top-bar').classList.contains('top-hidden')?(byId('siac-reading-modal-top-bar').classList.remove('top-hidden'),byId('siac-reading-modal-top-btns').classList.remove('top-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar false')):(byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar true'))},window.hideBothBars=function(){byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),pycmd('siac-config-bool notes.queue.hide_top_bar true'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true')},window.toggleBothBars=function(){byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')?(byId('siac-reading-modal-bottom-bar').classList.remove('bottom-hidden'),byId('siac-reading-modal-top-bar').classList.remove('top-hidden'),byId('siac-reading-modal-top-btns').classList.remove('top-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar false'),pycmd('siac-config-bool notes.queue.hide_top_bar false')):(byId('siac-reading-modal-bottom-bar').classList.add('bottom-hidden'),byId('siac-reading-modal-top-bar').classList.add('top-hidden'),byId('siac-reading-modal-top-btns').classList.add('top-hidden'),pycmd('siac-config-bool notes.queue.hide_bottom_bar true'),pycmd('siac-config-bool notes.queue.hide_top_bar true'))},window.bothBarsAreHidden=function(){return byId('siac-reading-modal-top-bar').classList.contains('top-hidden')&&byId('siac-reading-modal-bottom-bar').classList.contains('bottom-hidden')},window.topBarIsHidden=function(){return byId('siac-reading-modal-top-bar').classList.contains('top-hidden')},window.toggleReadingModalFullscreen=function(){pdf.fullScreen=!pdf.fullScreen,pdf.fullScreen?($(document.body).removeClass('siac-fullscreen-show-fields').addClass('siac-fullscreen-show-right'),pdf.instance&&pdfFitToPage(),hideBothBars()):($(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right'),onWindowResize(),pdf.instance&&pdfFitToPage())},window.activateReadingModalFullscreen=function(){pdf.fullScreen=!1,toggleReadingModalFullscreen()},window.onReadingModalClose=function(){if(!pdfLoading){if(displayedNoteId=null,$(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right').removeClass('siac-reading-modal-displayed'),$('#siac-left-tab-browse,#siac-left-tab-pdfs,#siac-left-tab-md,#siac-reading-modal-tabs-left').remove(),$('#fields').show(),$('#siac-reading-modal').hide(),byId('resultsArea').style.display='block',byId('bottomContainer').style.display='block',byId('topContainer').style.display='flex',destroyPDF(),SIAC.Filetree.destroy(),siacYt.player)try{siacYt.player.destroy()}catch(t){}byId('siac-reading-modal-center').innerHTML='',onWindowResize(),SIAC.Fields.cacheFields(),SIAC.State.searchOnTyping&&setSearchOnTyping(!0,!1),pycmd('siac-on-reading-modal-close')}},window.modalTabsLeftClicked=function(e,t){$('#siac-reading-modal-tabs-left > div').removeClass('active'),$(t).addClass('active'),pycmd('siac-reading-modal-tabs-left-'+e)},window.setPdfTheme=function(e){document.documentElement.style.setProperty('--c-reading-modal-theme-color',e),pycmd('siac-eval update_config(\'styles.readingModalThemeColor\', \''+e+'\')')},window.removeDialogOk=function(e){'1'==$('input[name=del]:checked').data('pycmd')?pycmd('siac-remove-from-queue '+e):pycmd('siac-delete-current-user-note '+e),modalShown=!1,$('#siac-rm-greyout').hide(),$('#siac-schedule-dialog').hide()},window.togglePageSidebar=function(e=!0){pageSidebarDisplayed=!pageSidebarDisplayed,pageSidebarDisplayed?(byId('siac-page-sidebar')&&(byId('siac-page-sidebar').style.display='flex'),$('#siac-reading-modal-center').addClass('siac-page-sidebar'),e&&(pdf.instance?pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`):pycmd(`siac-linked-to-page -1 -1`))):(byId('siac-page-sidebar')&&$('#siac-page-sidebar').hide(),$('#siac-reading-modal-center').removeClass('siac-page-sidebar')),e&&(pdf.instance&&pdfFitToPage(),pycmd('siac-config-bool pdf.page_sidebar_shown '+pageSidebarDisplayed))},window.updatePageSidebarIfShown=function(){pdf.instance&&pageSidebarDisplayed?pycmd(`siac-linked-to-page ${pdf.page} ${pdf.instance.numPages}`):pycmd(`siac-linked-to-page -1 -1`)},window.modalBgUpdate=function(){$('.siac-link-btn').addClass('siac-disabled'),setTimeout(function(){$('.siac-link-btn').removeClass('siac-disabled')},1400)},window.windowHasSelection=function(){return 0<window.getSelection().toString().trim().length},window.pdfLoaderText=function(e){try{byId('siac-pdf-loader-text').innerHTML=e}catch(t){}}},function(){window.nodesInSelection=function(e){let t=byId('text-layer');if(!t)return null;var a=t.children;let n=[],s=!1,d='#text'===e.startContainer.nodeName?e.startContainer.parentNode:e.startContainer,o='#text'===e.endContainer.nodeName?e.endContainer.parentNode:e.endContainer;for(var l=0;l<a.length&&(a[l]==d&&(s=!0),s&&n.push(a[l]),a[l]!=o);l++);return n},window.getSentencesAroundSelection=function(e,t,a){if(!e.startContainer)return;a=a.replace(/  +/g,' ').trim();let n=e.startContainer.parentElement.previousSibling,s='',d=0,o=0;if(1===t.length)s=t[0].innerHTML,d=t[0].clientHeight;else for(var l=0;l<t.length;l++)s+=t[l].innerHTML+' ',d=t[l].clientHeight;o=t[0].offsetTop,s=s.replace(/  +/g,' ').trim();let i=[];for(n||i.push(s);n;){if(5<Math.abs(n.clientHeight-d)||o-n.offsetTop>1.5*d){i.push(s);break}o=n.offsetTop,s=(n.innerHTML+' '+s).replace(/  +/g,' ').trim();let e=extractPrev(s,i,a);if(i=e[1],e[0])break;if(n=n.previousSibling,!n){i.push(s);break}}let r=[];for(var l=0;l<i.length;l++)for(s=i[l],n=e.endContainer.parentElement.nextSibling,n||r.push(s);n;){s=(s+' '+n.innerHTML).replace(/  +/g,' ').trim();let e=extractNext(s,r,a);if(r=e[1],e[0])break;if(n=n.nextSibling,!n){r.push(s);break}}return r},window.sendClozes=function(){let e=$('#siac-pdf-tooltip').data('sentences'),t=$('#siac-pdf-tooltip').data('selection');pycmd('siac-show-cloze-modal '+t+'$$$'+e.join('$$$'))},window.generateClozes=function(){let e='';$('.siac-cl-row').each(function(t,i){e+='$$$'+$(i.children[0].children[0]).text()});let t=$('#siac-pdf-top').data('pdfpath'),i=$('#siac-pdf-top').data('pdftitle');pycmd('siac-generate-clozes $$$'+i+'$$$'+t+'$$$'+pdf.page+e),$('#siac-pdf-tooltip').hide()},window.extractPrev=function(e,t,i){e=e.substring(0,e.lastIndexOf(i)+i.length)+e.substring(e.lastIndexOf(i)+i.length).replace(/\./g,'$DOT$'),e=e.replace(/etc\./g,'$etc$'),e=e.replace(/e\.g\./g,'$eg$'),e=e.replace(/i\.e\./g,'$ie$'),e=e.replace(/cf\./g,'$cf$'),e=e.replace(/\.,/g,'$cc$');let a=e.match(/.*[^.\d][.!?]"? (.+)/);if(!a||-1===a[1].indexOf(i))return[!1,t];let n=a[1].replace(/\$DOT\$/g,'.');return n=n.replace(/\$etc\$/g,'etc.'),n=n.replace(/\$eg\$/g,'e.g.'),n=n.replace(/\$ie\$/g,'i.e.'),n=n.replace(/\$cf\$/g,'cf.'),n=n.replace(/\$cc\$/g,'.,'),-1===t.indexOf(n)&&t.push(n),[!0,t]},window.extractNext=function(e,t,i){e=e.substring(0,e.indexOf(i)).replace(/\./g,'$DOT$')+e.substring(e.indexOf(i)),e=e.replace(/etc\./g,'$etc$'),e=e.replace(/e\.g\./g,'$eg$'),e=e.replace(/i\.e\./g,'$ie$'),e=e.replace(/cf\./g,'$cf$'),e=e.replace(/\.,/g,'$cc$');let a=e.match(/(.+?(\.\.\.(?!,| [a-z])|[^.]\.(?!(\.|[0-9]|[A-Z]{2,20}))|[!?]|[^0-9]\. [A-Z])).*/);if(!a||-1===a[1].indexOf(i))return[!1,t];let n=a[1].replace(/\$DOT\$/g,'.');return n=n.replace(/\$etc\$/g,'etc.'),n=n.replace(/\$eg\$/g,'e.g.'),n=n.replace(/\$ie\$/g,'i.e.'),n=n.replace(/\$cf\$/g,'cf.'),n=n.replace(/\$cc\$/g,'.,'),-1===t.indexOf(n)&&t.push(n),[!0,t]}},function(){var e=Math.min,i=Math.abs,t=Math.max;window.SIAC.Highlighting=new function(){this.colorSelected={id:1,color:'red'},this.current=[],this.highlight=function(e){let t=window.getSelection(),i=t.getRangeAt(0);$('#text-layer > span').css('height','auto');let a=i.getClientRects();if(100<a.length)return void readerNotification('Selection too long to highlight.');let s=n(a),d=byId('text-layer').getBoundingClientRect(),o=e||this.colorSelected.id,l=pdf.page+' -1 '+o+' ';s.forEach((e)=>{let t=e.x-d.x,i=e.y-d.y,a=pdf.displayedViewPort.convertToPdfPoint(t,i);l+=a[0]+' '+a[1]+' ',a=pdf.displayedViewPort.convertToPdfPoint(t+e.w,i+e.h),l+=a[0]+' '+a[1]+' '}),l+='# '+t.toString(),t.removeAllRanges(),pycmd('siac-hl-new '+l),$('#text-layer > span').css('height','100px')},this.createAreaHighlight=function(e,i,a,n){let s=this.colorSelected.id;if(!(1>s||2>a&&2>n)&&!(e+a>activeCanvas().offsetWidth)&&!(i+n>activeCanvas().offsetHeight)){6<=s&&(s+=3,e-=3,i-=3);let t=pdf.displayedViewPort.convertToPdfPoint(e,i),d=pdf.displayedViewPort.convertToPdfPoint(e+a,i+n),o=`siac-hl-new ${pdf.page} -1 ${s} ${t[0]} ${t[1]} ${d[0]} ${d[1]} # `;pycmd(o)}},this.insertText=function(e){let t=byId('text-layer').getBoundingClientRect(),i=byId('text-layer').offsetLeft,a=e.clientX-t.x,n=e.clientY-t.y;s(a+i,n,100,20,this.colorSelected.id,'');let d=pdf.page+' -1 0 ',o=pdf.displayedViewPort.convertToPdfPoint(a,n);d+=o[0]+' '+o[1]+' ',o=pdf.displayedViewPort.convertToPdfPoint(a+100,n+20),d+=o[0]+' '+o[1]+' #',pycmd('siac-hl-new '+d)},this.displayFakeHighlight=function(){s(0,0,50,50,1,-1)},this.displayHighlights=function(){this.removeAllHighlights();let a=activeCanvas();if(a){let t=byId('siac-pdf-overflow').scrollTop;this.current.forEach((n)=>{let d=n[0],o=n[1],l=n[2],r=n[3],c=n[4],t=n[5],p=n[6],g=pdf.displayedViewPort.convertToViewportRectangle([d,o,l,r]),f=e(g[0],g[2]);f+=a.offsetLeft;let u=e(g[1],g[3]),m=i(g[0]-g[2]),y=i(g[1]-g[3]);s(f,u,m,y,c,t,p)}),byId('siac-pdf-overflow').scrollTop=t}},this.removeAllHighlights=function(){for(let e=document.getElementsByClassName('siac-hl');e[0];)e[0].parentNode.removeChild(e[0])};var a=function(e){return 0===e?'white':1===e?'#e65100':2===e?'#558b2f':3===e?'#2196f3':4===e?'#ffee58':5===e?'#ab47bc':6===e||9===e?'#e65100':7===e||10===e?'#558b2f':8===e||11===e?'#2196f3':void 0},n=function(a){let s,d,o,l=!0,r=0,c=[];for(var p=0;p<a.length;p++)c.push({x:a[p].x,y:a[p].y,w:a[p].width,h:a[p].height});if(1===c.length)return c;for(;l;){l=!1;let a=[],p=0;for(var n=0;n<c.length;n++)if(!(l&&p===n)){if(s=c[n].x,d=c[n].y,o=c[n].w,r=c[n].h,!l)for(p=0;p<c.length;p++)if(p!==n&&(c[p].x===s&&c[p].y===d&&c[p].w===o&&c[p].h!==r?(r=t(c[p].h,r),l=!0):c[p].x===s&&c[p].y===d&&c[p].w!==o&&c[p].h===r?(o=t(c[p].w,o),l=!0):c[p].x===s&&c[p].y!==d&&c[p].w===o&&c[p].h===r?(d=e(d,c[p].y),l=!0):c[p].x!==s&&c[p].y===d&&c[p].w===o&&c[p].h===r?(s=e(s,c[p].x),l=!0):c[p].x!==s&&c[p].y===d&&c[p].w===o&&c[p].h!==r&&100>i(c[p].h-r)?(s=e(s,c[p].x),r=t(c[p].h,r),l=!0):c[p].x!==s&&c[p].y===d&&c[p].h===r?(c[p].x<s?(o=s+o-c[p].x,s=c[p].x):o=c[p].x+c[p].w-s,l=!0):c[p].x===s&&c[p].w===o?(r=t(c[p].h,r,t(d+r,c[p].y+c[p].h)-e(c[p].y,d)),d=e(c[p].y,d),l=!0):c[p].y>d&&c[p].y+c[p].h<d+r?(o=t(c[p].w,o,c[p].x+c[p].w-e(c[p].x,s),s+o-e(c[p].x,s)),s=e(c[p].x,s),l=!0):i(c[p].y-d)<r&&(o=t(c[p].w,o,c[p].x+c[p].w-e(c[p].x,s),s+o-e(c[p].x,s)),d=e(c[p].y,d),r=c[p].h+i(c[p].y-d),l=!0),l)){p<n&&a.splice(p,1);break}-1===a.indexOf({x:s,y:d,w:o,h:r})&&a.push({x:s,y:d,w:o,h:r})}if(l&&c.length===a.length)return console.log('something went terribly wrong'),c;c=Array.from(a)}return c};this.onColorBtn=function(e){this.colorSelected={id:+$(e).data('id'),color:$(e).data('color')},$('.siac-pdf-color-btn,.siac-pdf-ul-btn').removeClass('active'),$(e).addClass('active'),pycmd('siac-hl-clicked '+this.colorSelected.id+' '+this.colorSelected.color),0<this.colorSelected.id?(windowHasSelection()&&byId('text-layer')&&SIAC.Helpers.selectionIsInside(byId('text-layer'))&&this.highlight(),readerNotification('CTRL + select to Highlight<br>CTRL + Shift + A to Area Highlight')):readerNotification('CTRL + click to insert text<br>CTRL + click again to remove')},this.onTextMouseUp=function(e,t){if(t.dataset.id&&(t.offsetWidth!=t.dataset.ow||t.clientHeight!=t.dataset.oh)){t.dataset.ow=t.offsetWidth,t.dataset.oh=t.clientHeight;let e=t.offsetLeft-activeCanvas().offsetLeft,i=t.offsetTop,a=e+t.offsetWidth-6,n=i+t.clientHeight,s=pdf.displayedViewPort.convertToPdfPoint(e,i);e=s[0],i=s[1],s=pdf.displayedViewPort.convertToPdfPoint(a,n),a=s[0],n=s[1],pycmd(`siac-hl-text-update-coords ${t.dataset.id} ${e} ${i} ${a-2} ${n+2}`)}},this.onTextBlur=function(e){e.dataset.id&&pycmd(`siac-hl-text-update-text ${e.dataset.id} ${pdf.page} ${$(e).val()}`)},this.onTextKeyup=function(e){$(e).height(1),$(e).height($(e).prop('scrollHeight')+1),this.onTextMouseUp(null,e)},this.hlClick=function(e,t){!t.dataset.id||(e.ctrlKey||e.metaKey)&&(this.current=this.current.filter((e)=>e[5]!=t.dataset.id),pycmd('siac-hl-del '+t.dataset.id),$(t).remove())};var s=function(e,i,n,s,d,t=-1,o=''){let l;return 0<d?(l=document.createElement('div'),l.className='siac-hl siac-hl-c',l.style.height=s+'px',l.style.width=n+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.setAttribute('onclick','SIAC.Highlighting.hlClick(event, this);'),6<=d&&9>d?l.style.borderBottom='3px solid '+a(d):9<=d?l.style.border='3px solid '+a(d):l.style.background=a(d)):(l=document.createElement('textarea'),l.className='siac-hl siac-text-hl',l.style.height=s+'px',l.style.width=n+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.value=o,l.setAttribute('onclick','SIAC.Highlighting.hlClick(event, this);'),l.style.background=a(d),l.setAttribute('onmouseup','SIAC.Highlighting.onTextMouseUp(event, this);'),l.setAttribute('onblur','SIAC.Highlighting.onTextBlur(this);'),l.setAttribute('onkeyup','SIAC.Highlighting.onTextKeyup(this);')),byId('siac-pdf-overflow').append(l),l}}},function(){var e=Math.abs,t=Math.max;window.SIAC.Colors=new function(){var e=function(e,t,i){e.globalCompositeOperation='source-atop',e.globalAlpha=i,e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation='source-over',e.globalAlpha=1},t=function(e){e.globalCompositeOperation='difference',e.fillStyle='white',e.fillRect(0,0,e.canvas.width,e.canvas.height)},i=function(e,t){e.globalCompositeOperation='darken',e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)};this.pdfColorMode='',this.setPDFColorMode=function(e){$('#siac-pdf-color-mode-btn > span').first().text(e),this.pdfColorMode=e,pycmd('siac-update-config-str pdf.color_mode '+e),$('#siac-pdf-top').removeClass('siac-pdf-sand siac-pdf-night siac-pdf-peach siac-pdf-day siac-pdf-rose siac-pdf-moss siac-pdf-coral siac-pdf-x1 siac-pdf-x2 siac-pdf-mud siac-pdf-spooky').addClass('siac-pdf-'+this.pdfColorMode.toLowerCase())},this.invertCanvas=function(a){'Night'===this.pdfColorMode?e(a,'blue',.3):'X1'===this.pdfColorMode?(t(a),e(a,'teal',.4),i(a,'lightsalmon')):'X2'===this.pdfColorMode?(t(a),e(a,'darkslategrey',.4),i(a,'coral')):'Mud'===this.pdfColorMode?(t(a),e(a,'coral',.3),i(a,'coral')):'Coral'===this.pdfColorMode?i(a,'#ffb89e'):'Sand'===this.pdfColorMode?i(a,'#ffebb3'):'Peach'===this.pdfColorMode?i(a,'#ffcba4'):'Moss'===this.pdfColorMode?e(a,'green',.4):'Spooky'===this.pdfColorMode&&(t(a),i(a,'#e50045')),a.canvas.style.display='inline-block'},this.shouldChangeColors=function(){return-1!==['Sand','Peach','Night','X1','X2','Mud','Coral','Moss','Spooky'].indexOf(this.pdfColorMode)},this.refreshCanvas=function(){try{const e=activeCanvas().getContext('2d');e.putImageData(e.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)}catch(t){}},this.setTextureBg=function(e,t,i='svg'){pycmd('siac-update-config-str styles.readingModalBackgroundSize $1'.replace('$1',t)),pycmd('siac-styling styles.readingModalTexture url(\'$1.$2\')'.replace('$1',e).replace('$2',i))}}},function(){SIAC.MD=new function(){var e={};this.tryExtractTextFromTextNote=function(){this.saveTextNote($('#siac-reading-modal-top-bar').data('nid')),pycmd('siac-try-copy-text-note')},this.saveTextNote=function(e){let t='';try{t=textEditor.value()}catch(t){return void pycmd('siac-notification Could not save text note for some reason.')}readerNotification('&nbsp;<i class=\'fa fa-save\'></i>&nbsp; Note saved.&nbsp;'),pycmd('siac-update-note-text '+e+' '+t)},this.editorMDInit=function(e){textEditor=new SimpleMDE({element:e,indentWithTabs:!0,autoDownloadFontAwesome:!1,autosave:{enabled:!1},placeholder:'',status:!1,tagSize:4,toolbar:['bold','italic','heading','|','code','quote','unordered-list','ordered-list','horizontal-rule','|','image','link','|','preview']})},this.mdSidebarEdit=function(t,i){e[t]=new SimpleMDE({element:i,indentWithTabs:!0,autoDownloadFontAwesome:!1,autosave:{enabled:!1},placeholder:'',status:!1,tagSize:4,toolbar:['bold','italic','heading','|','code','quote','unordered-list','ordered-list','horizontal-rule','|','image','link','|','preview']}),e[t].codemirror.on('blur',function(){let i=window.SIAC.Helpers.b64EncodeUnicode(t),a=e[t].value(),n=window.SIAC.Helpers.b64EncodeUnicode(a);window.pycmd('siac-update-md-file '+i+' '+n)})},this.mdSidebarDestroy=function(t){if(!(t in e))return;let i=e[t];i.toTextArea(),i=null,delete e[t]}},window.textEditorKeyup=function(){if(pdf.tooltip.enabled&&windowHasSelection()){let e=window.getSelection(),t=e.getRangeAt(0),i=e.toString();if(0===i.trim().length||500<i.length)return;let a=nodesInSelection(t),n=getSentencesAroundSelection(t,a,i);1<a.length&&(i=joinTextLayerNodeTexts(a,i));let s=t.getBoundingClientRect(),d=byId('siac-reading-modal').getBoundingClientRect();byId('siac-pdf-tooltip-results-area').innerHTML='<center>Searching...</center>';let o=s.left-d.left;250>d.width-o&&(o-=200);let l=s.top-d.top+s.height;if(0>l)return;$('#siac-pdf-tooltip').css({top:l+'px',left:o+'px'}).show(),pycmd('siac-pdf-selection '+i),$('#siac-pdf-tooltip').data({sentences:n,selection:i,top:l})}}},function(){var e=Math.trunc;window.siacYt={player:null,ready:!1},window.onYouTubeIframeAPIReady=function(){siacYt.ready=!0},window.initYtPlayer=function(e,t,i){return i||(i=1),!siacYt.ready&&10>i&&setTimeout(()=>{initYtPlayer(e,t,i+1)},100),'undefined'==typeof YT?void readerNotification('Seems like Youtube API is not loaded. Maybe check your internet connection?'):void(siacYt.player=new YT.Player('siac-yt-player',{height:'360',width:'640',videoId:e,playerVars:{start:t}}))},window.ytCurrentTime=function(){return e(siacYt.player.getCurrentTime())},window.ytScreenCapture=function(){let t=document.getElementById('siac-yt-player');if(t){let i=t.getBoundingClientRect();pycmd(`siac-screen-capture -1 ${e(i.top)} ${e(i.left)} ${e(i.width)} ${e(i.height)}`)}},window.ytSavePosition=function(){let t=ytCurrentTime(),i=t%60;10>i&&(i='0'+i),pycmd('siac-yt-save-time '+t),readerNotification(`Saved Position.<br>Video will resume at ${e(t/60)}:${i}`)}},function(){window.SIAC.Filetree=new function(){this.init=function(){('undefined'==typeof window.ftreeVue||null===window.ftreeVue)&&(window.ftreeVue=new Vue({el:'#siac-left-tab-md'}))},this.destroy=function(){'undefined'!=typeof window.ftreeVue&&(window.ftreeVue=null)}}},function(){window.SIAC.Fields={_fields:[],enableSearchOnTypingEventListener:function(){this._fields&&0!==this._fields.length||this.cacheFields();for(let e of this._fields)e.removeEventListener('keydown',fieldKeypress,!1),e.addEventListener('keydown',fieldKeypress,!1)},disableSearchOnTypingEventListener:function(){this._fields&&0!==this._fields.length||this.cacheFields();for(let e of this._fields)e.removeEventListener('keydown',fieldKeypress,!1)},setSelectionMouseUpEventListener:function(){let t=document.getElementsByClassName('editor-field');if(!t||!t.length)return void console.warn('[SIAC] setSelectionMouseUpEventListener(): no field elements found.');for(let i of t)i.setAttribute('onmouseup','getSelectionText()')},getFocusedFieldText:function(){if(window.getCurrentField)return window.getCurrentField().shadowRoot.querySelector('anki-editable').innerText;let e=document.querySelector('.field:focus');return e?e.innerText:null},saveField:function(e){pycmd(`blur:${e}:${this._noteId()}:${this.getFieldHtml(e)}`)},getFieldHtml:function(e){return e<this._fields.length?this._fields[e].innerHTML:null},setFieldHtml:function(e,t){e<this._fields.length&&(this._fields[e].innerHTML=t),this.saveField(e)},appendSelectionToFieldHtml:function(e){let t=selectionCleaned();t&&0<t.length&&this.appendToFieldHtml(e,t)},appendToFieldHtml:function(e,t){e<this._fields.length&&(!this._fields[e].innerHTML||''===this._fields[e].innerHTML.trim()||/^(?:<div><\/div>|<br\/?>)$/.test(this._fields[e].innerHTML)?(this._fields[e].innerHTML=t,this._fields[e].innerHTML.startsWith('<br>')&&(this._fields[e].innerHTML=this._fields[e].innerHTML.substring(4))):this._fields[e].innerHTML+='<br>'+t),this.saveField(e)},getAllFieldsText:function(){let e='';for(var t=0;t<this._fields.length;t++)e+=this._fields[t].innerText+'\x1F';return e},cacheFields:function(){this._fields=[];let e=document.querySelectorAll('.editing-area');if(!e||!e.length||!e[0].children[0].shadowRoot||!e[0].children[0].shadowRoot.querySelector('anki-editable'))return console.info('[SIAC] cacheFields(): .editing-area not found, retrying in 30ms.'),void setTimeout(this.cacheFields,30);for(let t of e){let e=t.children[0].shadowRoot.querySelector('anki-editable');if(!e){console.warn('[SIAC] cacheFields(): failed to find field element.');continue}this._fields.push(e)}this._fields.length||console.warn('[SIAC] cacheFields(): failed to find any fields.')},count:function(){return this._fields&&0!==this._fields.length||this.cacheFields(),this._fields.length},empty:function(){for(var e=0;e<this._fields.length;e++)if(this._fields[e].innerText&&0<this._fields[e].innerText.length)return!1;return!0},_noteId:function(){return'undefined'==typeof window.getNoteId?SIAC.State.noteId:getNoteId()},displaySelectionMenu:function(){this.hideSelectionMenu();let e=document.querySelectorAll('.field-state');if(!e.length)return void console.warn('[SIAC] .field-state not found.');for(var t=0;t<e.length;t++){let i=document.createElement('div');i.classList.add('siac-fld-sel-menu');let a=9>t?`<b title="CTRL/CMD + ${t+1}: Send to this field">${t+1}</b>`:'';i.innerHTML=`
                <i class='fa fa-reply-all' onmousedown='SIAC.Fields.appendSelectionToFieldHtml(${t})'></i>
                <i class='fa fa-picture-o ml-5' title='Append selection as image to this field' onmousedown='event.preventDefault(); selectionSnapshot(${t}); return false;'></i>
                ${a} 
                `,e[t].appendChild(i)}},hideSelectionMenu:function(){let e=document.querySelectorAll('.siac-fld-sel-menu');for(var t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])}},SIAC.Fields.cacheFields()},function(){window.SIAC.fetch=new function(){var e={};this.json=function(t,...i){let a=Date.now()+'-'+i.join(' ').split('').reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0);e[a]=t,pycmd('siac-fetch-json '+a+' '+i.join('$&&$'))},this.callback=function(t,i){return!t in e?void console.log('[SIAC] key not in fetch callback dict'):void(e[t](i),delete e.key)}}},function(){window.MathJax={tex:{displayMath:[['\\[','\\]']],processRefs:!1,processEnvironments:!1,packages:{"[+]":['noerrors','mhchem']}},startup:{typeset:!1,pageReady:()=>MathJax.startup.defaultPageReady()},options:{renderActions:{addMenu:[],checkLoading:[]},ignoreHtmlClass:'tex2jax_ignore',processHtmlClass:'siac-inner-card'},loader:{load:['[tex]/noerrors','[tex]/mhchem']}},window._mathjaxActivePromise=Promise.resolve(),window.refreshMathJax=function(){'undefined'==typeof MathJax?console.log('[SIAC] Seems like MathJax is not loaded.'):'undefined'==typeof MathJax.typesetPromise?console.log('[SIAC] Mathjax typeset fn not found.'):window._mathjaxActivePromise=window._mathjaxActivePromise.then(MathJax.typesetPromise)}},function(){}]));