(function(t,e){for(var n in e)t[n]=e[n]})(window,function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&'object'==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,'default',{enumerable:!0,value:e}),2&i&&'string'!=typeof e)for(var a in e)t.d(n,a,function(t){return e[t]}.bind(null,a));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(i,'a',i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=0)}([function(e,t,i){e.exports=i(6)},function(){var e=Math.min,t=Math.max;window.siacState={selectedDecks:['-1'],timeout:null,isFrozen:!1,searchOnSelection:!0,searchOnTyping:!0,keepPositionAtRendering:!1},window.lastHadResults=!1,window.loadingTimer=null,window.calTimer=null,window.gridView=!1,window.tagHoverCB=null,window.tagHoverTimeout=750,window.searchMaskTimer=null,window.$fields=null,window.sendContent=function(e){if(e&&e.repeat||null!=pdfDisplayed||siacState.isFrozen)return;if(!$fields.text())return;let t='';showLoading('Typing'),$fields.each(function(e,i){t+=i.innerHTML+'\x1F'}),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.searchCurrentField=function(){if(!(displayedNoteId||siacState.isFrozen)){let e=$('.field:focus').first();if(e.length){let i=e.text();i&&0!==i.trim().length&&(showLoading('Typing'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+i))}}},window.sendSearchFieldContent=function(){showLoading('Searchbar'),html=document.getElementById('siac-browser-search-inp').value+'\x1F',pycmd('siac-r-srch-db '+siacState.selectedDecks.toString()+' ~ '+html)},window.searchFor=function(e){showLoading('Note Search'),e+='\x1F',pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+e)},window.updateSelectedDecks=function(e){siacState.selectedDecks=[];let t='';e&&$(e).toggleClass('selected'),$('.deck-list-item.selected').each(function(){$(this).data('id')&&(siacState.selectedDecks.push($(this).data('id')),t+=' '+$(this).data('id'))}),pycmd('deckSelection'+t)},window.selectAllDecks=function(){$('.deck-list-item').addClass('selected'),updateSelectedDecks()},window.unselectAllDecks=function(){$('.deck-list-item').removeClass('selected'),updateSelectedDecks()},window.selectDeckWithId=function(e){$('.deck-list-item').removeClass('selected'),$('.deck-list-item').each(function(){$(this).data('id')==e&&$(this).addClass('selected')}),updateSelectedDecks()},window.selectDeckAndSubdecksWithId=function(e){$('.deck-list-item').removeClass('selected'),$(`.deck-list-item[data-id=${e}]`).addClass('selected'),$(`.deck-list-item[data-id=${e}] .deck-list-item`).addClass('selected'),updateSelectedDecks()},window.fixRetMarkWidth=function(e){e&&0<e.parentElement.getElementsByClassName('retMark').length&&0==e.parentElement.getElementsByClassName('retMark')[0].style.maxWidth.length&&(e.parentElement.getElementsByClassName('retMark')[0].style.maxWidth=e.offsetWidth+'px')},window.expandRankingLbl=function(e){fixRetMarkWidth(e),null===e.getElementsByClassName('rankingLblAddInfo')[0].offsetParent?(e.getElementsByClassName('rankingLblAddInfo')[0].style.display='inline',e.getElementsByClassName('editedStamp')[0].style.display='none',0!==e.parentElement.getElementsByClassName('siac-susp-lbl').length&&(e.parentElement.getElementsByClassName('siac-susp-lbl')[0].style.display='none')):(e.getElementsByClassName('rankingLblAddInfo')[0].style.display='none',e.getElementsByClassName('editedStamp')[0].style.display='inline',0!==e.parentElement.getElementsByClassName('siac-susp-lbl').length&&(e.parentElement.getElementsByClassName('siac-susp-lbl')[0].style.display='block'))},window.expandCard=function(e){pycmd('siac-note-stats '+e)},window.pinMouseLeave=function(e){$(e).css('opacity','0')},window.pinMouseEnter=function(e){$(e).css('opacity','1')},window.cardMouseEnter=function(e,t,i='full'){'full'==i?$(`#btnBar-${t}`).css('opacity','1'):$(`#btnBarSmp-${t}`).css('opacity','1')},window.showLoading=function(e){loadingTimer=setTimeout(function(){document.getElementById('searchInfo').innerHTML=`<table><tr><td>Status</td><td><b>Searching</b></td></tr><tr><td>Source</td><td><i>${e}</i></td></tr></table>`},1e3)},window.totalOffset=function(e){var t=0,i=0;do t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:i}},window.cardMouseLeave=function(e,t,i='full'){setTimeout(function(){'full'==i?!$('#btnBar-'+t).is(':hover')&&$('#btnBar-'+t).css('opacity','0'):!$('#btnBarSmp-'+t).is(':hover')&&$('#btnBarSmp-'+t).css('opacity','0')},100)},window.tagMouseEnter=function(e){showTagInfoOnHover&&e&&e.parentElement&&(tagHoverCB=setTimeout(function(){e&&e.parentElement&&e.parentElement.querySelector(':hover')===e&&!document.getElementById('siac-tag-info-box-'+$(e).data('stamp'))&&pycmd('siac-tag-info '+$(e).data('stamp')+' '+$(e).data('name'))},tagHoverTimeout))},window.showTagInfo=function(e){let t=$(e).data('stamp');$(e).css('z-index','9999'),e&&$('#greyout').show();let n=totalOffset(e);n.top+=17;let a=document.getElementsByClassName('siac-tag-info-box');e.parentElement.id&&'tagContainer'===e.parentElement.id?n.top-=document.getElementById('tagContainer').scrollTop:1<a.length?0<=e.parentElement.parentElement.parentElement.className.indexOf('siac-tag-info-box-left')&&(n.top-=e.parentElement.parentElement.parentElement.scrollTop):null===document.getElementById('cal-info').offsetParent?n.top-=document.getElementById('searchResults').scrollTop:n.top-=document.getElementById('cal-info-notes').scrollTop;let s='siac-tag-info-box-'+t;n.left>window.outerWidth-n.left&&(n.left-=$('#siac-tag-info-box-'+t).outerWidth(),n.left+=$(e).outerWidth()+2);let d=0;for(var l=0;l<a.length;l++)+$(a[l]).css('z-index')>d&&(d=+$(a[l]).css('z-index'));if($('#siac-tag-info-box-'+t).css('top',n.top).css('left',n.left).css('z-index',d+1),n.top>window.outerHeight-n.top){document.getElementById(s).style.visibility='hidden',document.getElementById(s).style.display='block';let e=17;1<a.length&&(e=15),$('#'+s).css('top',n.top-$('#'+s).outerHeight()-e),document.getElementById(s).style.visibility='visible'}else document.getElementById(s).style.display='block'},window.tagMouseLeave=function(e){let t=$(e).data('stamp');if(!($('#siac-tag-info-box-'+t+':hover').length||$(`.tagLbl[data-stamp='${t}']:hover`).length)){let i=document.getElementsByClassName('siac-tag-info-box'),a=+$(e).css('z-index'),s=$('.siac-tag-info-box:hover').first();if(!s.length&&!$(`.tagLbl[data-stamp]:hover`).length)return $('.siac-tag-info-box').remove(),$('.tagLbl').css('z-index','4'),void $('#greyout').hide();if(s.length){let t=+s.css('z-index');if(e.id&&t>a)return;for(var n=0;n<i.length;n++)+$(i[n]).css('z-index')>t&&($(i[n]).remove(),n--)}$(`.tagLbl[data-stamp='${t}']`).first().css('z-index','4'),document.getElementById('siac-tag-info-box-'+t)&&$('#siac-tag-info-box-'+t).remove(),(!i||1>i.length)&&$('#greyout').hide()}},window.tagInfoBoxClicked=function(e){let t=+$(e).css('z-index'),n=document.getElementsByClassName('siac-tag-info-box');for(var a=0;a<n.length;a++)+$(n[a]).css('z-index')<t&&($(n[a]).remove(),a--)},window.appendToField=function(e,t){$(`.field:eq(${e})`).text().length?$(`.field:eq(${e})`).append('<br/>'+t):$(`.field:eq(${e})`).html(t),pycmd(`blur:${e}:${currentNoteId}:${$(`.field:eq(${e})`).html()}`)},window.getSelectionText=function(){if(siacState.searchOnSelection&&!siacState.isFrozen){var e='';window.getSelection?e=window.getSelection().toString():document.selection&&'Control'!=document.selection.type&&(e=document.selection.createRange().text),0<e.trim().length&&'&nbsp;'!=e&&(showLoading('Selection'),pycmd('siac-r-fld-selected '+siacState.selectedDecks.toString()+' ~ '+e))}},window.searchForUserNote=function(e,t){t&&0!==t.value.length&&t.value.trim()&&(13==e.keyCode?(t.id&&(t.parentElement.parentElement.style.display='none'),pycmd('siac-r-user-note-search-inp '+t.value)):t.id&&('Escape'===e.key||'Esc'===e.key)?t.parentElement.style.display='none':(clearTimeout(searchMaskTimer),searchMaskTimer=setTimeout(function(){pycmd('siac-r-user-note-search-inp '+t.value)},800)))},window.searchUserNoteTag=function(t,e){t.ctrlKey||t.metaKey?pycmd('siac-create-note-tag-prefill '+e):pycmd('siac-r-user-note-search-tag '+e)},window.switchLeftRight=function(){let e=document.getElementById('leftSide'),t=document.getElementById('siac-right-side');'leftSide'===e.parentNode.children[0].id?(e.parentNode.insertBefore(t,e),$(document.body).addClass('siac-left-right-switched'),pycmd('siac-switch-left-right true')):(e.parentNode.insertBefore(e,t),$(document.body).removeClass('siac-left-right-switched'),pycmd('siac-switch-left-right false'))},window.onWindowResize=function(e=!0){let t=document.getElementById('topbutsOuter').offsetHeight+3;document.getElementById('outerWr').style.marginTop=t+'px',document.getElementById('outerWr').style.height=`calc(100vh - ${t}px)`,$('#switchBtn').is(':visible')||($('#leftSide').css('display','flex'),$('#outerWr').css('display','flex').removeClass('onesided'),document.getElementById('switchBtn').innerHTML='&#10149; Search'),e&&'undefined'!=typeof pdfDisplayed&&pdfDisplayed&&(this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){pdfDisplayed&&pdfFitToPage()},300))},window.setHighlighting=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('highlight '+t)},window.setTagSearch=function(e){let t=$(e).is(':checked')?'on':'off';pycmd('tagSearch '+t)},window.tagClick=function(e){if($(e).data('tags')&&$(e).data('tags')==$(e).data('name'))return $('#a-modal').show(),void pycmd('siac-render-tags '+$(e).data('tags'));let t=$(e).data('target')||$(e).data('name');$('.siac-tag-info-box').remove(),$('#greyout').hide(),pycmd('siac-tag-clicked '+t)},window.noteSidebarExpandAll=function(){$('#siac-notes-sidebar .exp').each(function(e,t){let i=$(t);i.text().length&&'[+]'===i.text()&&(i.text('[-]'),i.parent().parent().children('ul').toggle())})},window.noteSidebarCollapseAll=function(){$('#siac-notes-sidebar .exp').each(function(e,t){let i=$(t);i.text().length&&'[-]'===i.text()&&(i.text('[+]'),i.parent().parent().children('ul').toggle())})},window.deleteNote=function(e){document.getElementById('siac-del-modal').innerHTML='<center style="margin: 20px 0 20px 0;">Deleting...</center>',setTimeout(function(){pycmd('siac-delete-user-note '+e)},80)},window.synInputKeyup=function(e,t){13==e.keyCode&&t.value&&pycmd('siac-save-synonyms '+t.value)},window.synonymSetKeydown=function(e,t,i){13==e.keyCode&&t.innerHTML.length&&(pycmd('siac-edit-synonyms '+i+' '+t.innerHTML),e.preventDefault(),$(t).blur())},window.searchSynset=function(e){let t=e.parentElement.parentElement.children[0].children[0].innerHTML;t&&pycmd('siac-r-synset-search '+t)},window.updateFieldToExclude=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-exclude '+t+' '+i+' false'):pycmd('siac-update-field-to-exclude '+t+' '+i+' true')},window.updateFieldToHideInResult=function(e,t,i){$(e).is(':checked')?pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' false'):pycmd('siac-update-field-to-hide-in-results '+t+' '+i+' true')},window.setSearchOnTyping=function(e,t=!0){siacState.searchOnTyping=e,e?($('.field').on('keyup.siac',fieldKeypress),t&&sendContent()):$('.field').off('keyup.siac',fieldKeypress),sendSearchOnTyping()},window.sendSearchOnTyping=function(){pycmd('searchWhileTyping '+(siacState.searchOnTyping?'on':'off'))},window.sendSearchOnSelection=function(){pycmd('searchOnSelection '+(siacState.searchOnSelection?'on':'off'))},window.fieldKeypress=function(e){13==e.keyCode||9==e.keyCode||91==e.keyCode||37<=e.keyCode&&40>=e.keyCode||e.ctrlKey||e.altKey||(siacState.timeout&&(clearTimeout(siacState.timeout),siacState.timeout=null),siacState.timeout=setTimeout(function(){sendContent(e)},delayWhileTyping))},window.searchMaskKeypress=function(e){13===e.keyCode&&sendSearchFieldContent()},window.pinCard=function(e,t){$('#cW-'+t).css('padding','3px 4px 5px 5px'),$('#cW-'+t).css('font-size','9px');let i=document.getElementById('cW-'+t).getElementsByClassName('rankingLblAddInfo')[0],n=document.getElementById('cW-'+t).getElementsByClassName('editedStamp')[0];$('#cW-'+t).html('<span>&#128204;</span>'),document.getElementById('cW-'+t).appendChild(i),document.getElementById('cW-'+t).appendChild(n),$('#'+t).parents().first().addClass('pinned'),updatePinned()},window.searchCard=function(e){let t=$(e).parent().next().html();showLoading('Note Search'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.searchCardFromFloated=function(e){let t=document.getElementById(e).innerHTML;showLoading('Note Search'),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+t)},window.edit=function(e){pycmd('siac-edit-note '+e)},window.updatePinned=function(){let e='siac-pin';$('.pinned').each(function(){e+=' '+$(this).children().first().children().first().attr('id').substring(3)}),$('.noteFloating').each(function(){e+=' '+$(this).attr('id').substring(3)}),pycmd(e)},window.clearSearchResults=function(){let e=document.querySelectorAll('#searchResults .cardWrapper:not(.pinned)');for(var t=0;t<e.length;t++)e[t].remove();try{document.getElementById('startInfo').remove(),document.getElementById('greyout').style.display='none'}catch(t){}$('.siac-tag-info-box,#siac-results-loader-wrapper').remove(),$('.tagLbl').css('z-index','999')},window.setSearchResults=function(e,t,i,n=1,a=1,s=50,d=-1,l=-1,o=!1,r=!1){let g=new Date().getTime();clearSearchResults();var f=document.getElementById('searchResults');f.style.overflowY='hidden',f.style.paddingRight='24px',f.innerHTML+=e,r||siacState.keepPositionAtRendering||!(0<e.length)?siacState.keepPositionAtRendering&&(siacState.keepPositionAtRendering=!1):f.scrollTop=0;let p=1;if(clearTimeout(loadingTimer),i&&lastHadResults&&document.getElementById('info-Took')?(document.getElementById('info-Took').innerHTML=i.Took,document.getElementById('info-Found').innerHTML=i.Found,document.getElementById('tagContainer').innerHTML=i.Tags,document.getElementById('keywordContainer').innerHTML=i.Keywords):document.getElementById('searchInfo').innerHTML=t,lastHadResults=!!i,!renderImmediately){function t(){gridView?$('#nWr-'+(p+50*(n-1))).fadeIn().css('display','inline-block'):$('#nWr-'+(p+50*(n-1))).fadeIn(),setTimeout(function(){p++,p<count?t():(gridView?$('#searchResults .cardWrapper').css('display','inline-block'):$('#searchResults .cardWrapper').show(),f.style.overflowY='auto',f.style.paddingRight='10px',document.getElementById('greyout').style.display='none')},time)}if(time=gridView?100:130,count=gridView?16:10,-1<l&&document.getElementById('info-took'))if(o){let e=new Date().getTime()-l;document.getElementById('info-Took').innerHTML=`<b>${e}</b> ms &nbsp;<b style='cursor: pointer' onclick='pycmd("siac-last-timing ${new Date().getTime()-g}")'>&#9432;</b>`}else document.getElementById('info-Took').innerHTML=`<b>${new Date().getTime()-l}</b> ms`;t(),displayPagination(n,a,s,0<e.length,d)}else if(gridView?$('#searchResults .cardWrapper').css('display','inline-block'):$('#searchResults .cardWrapper').show(),f.style.overflowY='auto',f.style.paddingRight='10px',document.getElementById('greyout').style.display='none',displayPagination(n,a,s,0<e.length,d),-1<l&&document.getElementById('info-took'))if(o){let e=new Date().getTime()-l;document.getElementById('info-Took').innerHTML=`<b>${e}</b> ms &nbsp;<b style='cursor: pointer' onclick='pycmd("siac-last-timing ${new Date().getTime()-g}")'>&#9432;</b>`}else document.getElementById('info-Took').innerHTML=`<b>${new Date().getTime()-l}</b> ms`},window.displayPagination=function(n,s,a,d,l){if(-1!==l){let e='';if(1<l){e+=`<div onclick='pycmd("siac-rerender ${l-2}")' style='display: inline; cursor: pointer;'>Last Results: &nbsp;</div>`;for(var o=0;o<l-1;o++)e+=`<span onclick='pycmd("siac-rerender ${l-o-2}")'>${o+1}</span>`}document.getElementById('siac-cache-displ').innerHTML=e}let i='';if(0===s||!d)return document.getElementById('siac-pagination-status').innerHTML='',void(document.getElementById('siac-pagination-wrapper').innerHTML='');if(1===n&&1==s)i='';else{i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page 1")'>&#171;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${t(n-1,1)}")'>&#8249;</div>`;let d=0,a=0;n+5>s&&(d=n+5-s),0>=n-5&&(a=Math.abs(n-5)+1);for(var o=t(n-5-d,1);o<=n+5+a;o++)o==n?i+=`<div class='siac-pg-icn siac-pg-icn-active' onclick='pycmd("siac-page ${o}")'>${o}</div>`:o<=s&&(i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${o}")'>${o}</div>`);i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${e(n+1,s)}")'>&#8250;</div>`,i+=`<div class='siac-pg-icn' onclick='pycmd("siac-page ${s}")'>&#187;</div>`}document.getElementById('siac-pagination-status').innerHTML=`Showing ${50*(n-1)+1} - ${e(a,50*n)} of ${a}`,document.getElementById('siac-pagination-wrapper').innerHTML=i},window.sendClickedInformation=function(e,t){let i=document.elementFromPoint(e,t);return'IMG'==i.tagName?'img '+i.src:('SPAN'==i.tagName||'DIV'==i.tagName||'MARK'==i.tagName)&&'cardR'==i.parentElement.className?'note '+i.parentElement.id+' '+i.parentElement.innerHTML:'cardR'==i.className?'note '+i.id+' '+i.innerHTML:void 0},window.toggleTooltip=function(e){$(e).children().first().toggle()},window.toggleFreeze=function(e){siacState.isFrozen=!siacState.isFrozen,$(e).hasClass('frozen')?$(e).removeClass('frozen'):$(e).addClass('frozen')},window.hideTop=function(){$('#topContainer').hide(),$('#toggleTop').children().first().html('&#10097;'),pycmd('toggleTop off')},window.toggleTop=function(e){$('#topContainer').toggle(),$('#topContainer').is(':hidden')?($(e).children().first().html('&#10097;'),pycmd('toggleTop off')):($(e).children().first().html('&#10096;'),pycmd('toggleTop on'))},window.toggleGrid=function(e){$(e).is(':checked')?(pycmd('toggleGrid on'),gridView=!0):(pycmd('toggleGrid off'),gridView=!1)},window.activateGridView=function(){gridView=!0,window.setTimeout(function(){$('#gridCb').prop('checked',!0)},400)},window.predefSearchFromSidebar=function(e){let t=siacState.selectedDecks.toString();-1===['lowestPerf','highestPerf','highestRet','lowestRet'].indexOf(e)?pycmd('predefSearch '+e+' 200 '+t):(showSearchLoader('Computing'),setTimeout(function(){pycmd('predefSearch '+e+' 200 '+t)},250))},window.predefSearch=function(){let t=document.getElementById('predefSearchSelect'),e=t.options[t.selectedIndex].value,i=document.getElementById('predefSearchNumberSel'),n=i.options[i.selectedIndex].value,a=siacState.selectedDecks.toString();-1===['lowestPerf','highestPerf','highestRet','lowestRet'].indexOf(e)?pycmd('predefSearch '+e+' '+n+' '+a):(showSearchLoader('Computing'),setTimeout(function(){pycmd('predefSearch '+e+' '+n+' '+a)},250))},window.sort=function(){let t=document.getElementById('sortSelect'),e=t.options[t.selectedIndex].value;pycmd('siac-p-sort '+e)},window.toggleAddon=function(){try{'none'!==document.getElementById('siac-reading-modal').style.display&&pdfFullscreen?$(document.body).hasClass('siac-fullscreen-show-fields')?$(document.body).removeClass('siac-fullscreen-show-fields').addClass('siac-fullscreen-show-right'):$(document.body).addClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right'):($('#outerWr').hasClass('onesided')?(showSearchPaneOnLeftSide(),$('#siac-right-side').toggleClass('addon-hidden')):$('#switchBtn').is(':visible')?showSearchPaneOnLeftSide():$('#siac-right-side').toggleClass('addon-hidden'),pycmd('toggleAll '+($('#siac-right-side').hasClass('addon-hidden')?'off':'on'))),onWindowResize(!1)}catch(t){pycmd('siac-notification Failed to toggle: '+t.message)}},window.showSearchPaneOnLeftSide=function(){$('#outerWr').hasClass('onesided')?($('#leftSide').show(),document.getElementById('switchBtn').innerHTML='&#10149; Search',$('#outerWr').css('display','flex').removeClass('onesided')):($('#leftSide').hide(),$('#siac-right-side').removeClass('addon-hidden'),document.getElementById('switchBtn').innerHTML='&#10149; Back',$('#outerWr').css('display','block').addClass('onesided'),onWindowResize())},window.updateSwitchBtn=function(e){$('#outerWr').hasClass('onesided')||(document.getElementById('switchBtn').innerHTML=`&#10149; Search (${e})`)},window.removeNote=function(e){$(document.getElementById('cW-'+e).parentElement.parentElement).remove(),updatePinned()},window.getOffset=function(e){for(var t=0,i=0;e&&'siac-right-side'!==e.id&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:i,left:t}},window.calBlockMouseEnter=function(e,t){calTimer=setTimeout(function(){$('#cal-row').is(':hover')&&e.ctrlKey&&(displayCalInfo(t),calTimer=null)},100)},window.displayCalInfo=function(e){let t=getOffset(e.children[0]),i=t.left-153,n=document.getElementById('siac-second-col-wrapper').clientWidth-t.left-153;0>i?(i-=t.left-153,document.documentElement.style.setProperty('--tleft',t.left+'px')):document.documentElement.style.setProperty('--tleft','50%'),0>n&&(document.documentElement.style.setProperty('--tleft',-n+153+'px'),i+=n),$('#cal-info').css('left',i+'px').css('top',t.top-275+'px'),document.getElementById('cal-info').style.display='block',pycmd('siac-cal-info '+$(e.children[0]).data('index'))},window.calMouseLeave=function(){calTimer=setTimeout(function(){$('#cal-row').is(':hover')||$('#cal-info').is(':hover')||(document.getElementById('cal-info').style.display='none'),calTimer=null},300)},window.fieldsBtnClicked=function(){if(siacState.isFrozen)return void pycmd('siac-notification Results are frozen.');if(!$fields.text())return void pycmd('siac-notification Fields are empty.');let e='';showLoading('Typing'),$fields.each(function(t,i){e+=i.innerHTML+'\x1F'}),pycmd('siac-r-fld '+siacState.selectedDecks.toString()+' ~ '+e)},window.showModalSubpage=function(e){$('#modalText').hide(),$('#modal-subpage-inner').html(e),document.getElementById('modal-subpage').style.display='flex'},window.hideModalSubpage=function(){$('#modal-subpage-inner').html(''),$('#modal-subpage').hide(),$('#modalText').show()},window.showLoader=function(e,t,i){i=i?i:0,$('#'+e).append(`
    <div id='siac-loader-modal' class='siac-modal-small' contenteditable=false style='position-relative; text-align: center; margin-top: ${i}px;'>
        <div> <div class='signal' style='margin-left: auto; margin-right: auto;'></div><br/><div id='siac-loader-text'>${t}</div></div>
    </div>
    `)},window.showSearchLoader=function(e){if(!document.getElementById('siac-results-loader-wrapper')){let t=document.getElementById('searchResults');t.scrollTop=0,t.style.overflowY='hidden',$(t).append(`
    <div id='siac-results-loader-wrapper' style='position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 5; height: 100%; text-align: center; background: rgba(0,0,0,0.4); display:flex; align-items: center; justify-content: center; border-radius: 5px;'>
        <div class='siac-search-loader' style='display: inline-block; vertical-align: middle;'>
            <b>${e}</b>
        </div>
    </div>`)}},window.toggleSearchbarMode=function(e){'Mode: Browser'===e.innerHTML?(e.innerHTML='Mode: Add-on',pycmd('siac-searchbar-mode Add-on')):(e.innerHTML='Mode: Browser',pycmd('siac-searchbar-mode Browser'))},window.globalKeydown=function(t){displayedNoteId&&122===t.keyCode?toggleReadingModalBars():pdfDisplayed&&!$('.field').is(':focus')&&pdfViewerKeyup(t)},window.toggleNoteSidebar=function(){document.getElementById('siac-notes-sidebar')?pycmd('siac-hide-note-sidebar'):pycmd('siac-show-note-sidebar')},window.focusSearchShortcut=function(){null===displayedNoteId&&document.getElementById('siac-browser-search-inp')&&document.getElementById('siac-browser-search-inp').focus()},window.triggerSearchShortcut=function(){displayedNoteId||sendContent()},window.addFloatingNote=function(e){let t=$('#'+e.toString()).hasClass('siac-user-note')?`pycmd("siac-edit-user-note ${e}")`:`edit(${e})`,i=document.getElementById(e).innerHTML;i=i.replace(/<\/?mark>/g,''),$('#cW-'+e).parent().parent().remove();let n=`<div class='floatingBtnBar'>
        <div class="floatingBtnBarItem" onclick='${t}'>Edit</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" onclick='searchCardFromFloated("nFC-${e}")'>Search</div>&nbsp;&#65372;
        <div class="floatingBtnBarItem" id='rem-${e}' onclick='document.getElementById("nF-${e}").outerHTML = ""; updatePinned();'><span>&#10006;&nbsp;&nbsp;</span></div>
    </div>`,a=`<div id="nF-${e}" class='noteFloating'>
            <div id="nFH-${e}" class='noteFloatingHeader' onmousedown='dragElement(this.parentElement, "nFH-${e}")'>&nbsp;${n}</div>
            <div id="nFC-${e}" class='noteFloatingContent'  onmouseup='getSelectionText()' >${i}</div>
                </div>
            `;8<$('.field').length?$('.field').first().after(a):$('.field').last().after(a),dragElement(document.getElementById('nF-'+e),`nFH-${e}`),updatePinned()},window.dragElement=function(t,e,i=!1){function n(t){t=t||window.event,t.preventDefault(),o=t.clientX,r=t.clientY,document.onmouseup=s,document.onmousemove=a}function a(i){i=i||window.event,i.preventDefault(),d=o-i.clientX,l=r-i.clientY,o=i.clientX,r=i.clientY,t.style.top=t.offsetTop-l+'px',t.style.left=t.offsetLeft-d+'px'}function s(){document.onmouseup=null,document.onmousemove=null}var d=0,l=0,o=0,r=0;document.getElementById(e)?document.getElementById(e).onmousedown=n:t.onmousedown=n},window.drawHeatmap=function(e,t){if('undefined'==typeof CalHeatMap)return void setTimeout(()=>{drawHeatmap(e,t)},200);var i=new CalHeatMap;let n={min:'#8cecff',max:'#008eab',empty:'#e8e8e8'};document.body.classList.contains('nightMode')&&(n={min:'#fed976',max:'#800026',empty:'black'});let a=10,s=2,d='%B',l=document.getElementById('searchResults').offsetWidth;600>l?(a=6,s=1,d='%b'):700>l?(a=7,d='%b'):750>l?a=8:800>l&&(a=9),i.init({data:t,legendColors:n,itemName:['page','pages'],itemSelector:e,considerMissingDataAsZero:!0,dataType:'json',start:new Date(new Date().getFullYear(),0),maxDate:new Date,range:12,rowLimit:7,cellSize:a,cellPadding:s,domain:'month',domainLabelFormat:d,subDomain:'day'})}},function(){var e=Math.min,a=Math.max;window.pdfSearchOngoing=!1,window.pdfCurrentSearch={query:null,lastStart:null,lastEnd:null,breakOnNext:null},window.onPDFSearchBtnClicked=function(e){$(e).hasClass('expanded')?$(e).find('input').focus():($(e).find('input').val(''),pdfCurrentSearch={query:null,lastEnd:null,lastStart:null})},window.onPDFSearchInput=function(e,t){13===t.keyCode&&e&&e.trim().length&&(readerNotification('Searching ...'),e.toLowerCase()!==pdfCurrentSearch.query&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=e.toLowerCase()),setTimeout(function(){nextPDFSearchResult()},10))},window.getContents=async function(e=1,t=1e4){for(var i,n=[],a=e;a<=pdfDisplayed.numPages&&a<=e+t;a++)i=pdfDisplayed.getPage(a),n.push(i.then(function(e){var t=e.pageIndex+1,a='',i=e.getTextContent();return i.then(function(e){for(var s=0;s<e.items.length;s++)a+=' '+e.items[s].str;return{page:t,text:a.toLowerCase()}})}));return Promise.all(n).then(function(e){return e})},window.resetSearch=function(){pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null},window.nextPDFSearchResult=async function(e='right'){if(!pdfSearchOngoing){let i=$('#siac-pdf-search-btn-inner input').first().val().toLowerCase();if(null===pdfCurrentSearch.query?pdfCurrentSearch.query=i:(i!==pdfCurrentSearch.query||pdfDisplayedCurrentPage!==pdfCurrentSearch.lastStart&&pdfCurrentSearch.lastStart===pdfCurrentSearch.lastEnd)&&(pdfCurrentSearch.lastStart=null,pdfCurrentSearch.lastEnd=null,pdfCurrentSearch.query=i),!!pdfCurrentSearch.query){pdfCurrentSearch.breakOnNext=!1,pdfSearchOngoing=!0,greyoutBottom();var t=!1,a=!1,s=pdfCurrentSearch.query.toLowerCase().split(' '),d=0;do{d++;var l=getNextPagesToSearchIn(e);if('left'===e)var o=(await getContents(l.s,l.n)).reverse();else var o=await getContents(l.s,l.n);0===o.length&&(t=!0);for(var r=0;r<o.length&&!t;r++)for(var n=0;n<s.length;n++)if(-1!==o[r].text.indexOf(s[n])){pdfDisplayedCurrentPage===o[r].page?readerNotification('Text found on current page',!0):readerNotification('Text found on page '+o[r].page,!0),pdfDisplayedCurrentPage=o[r].page,queueRenderPage(pdfDisplayedCurrentPage,!0,!1,!1,pdfCurrentSearch.query),pdfCurrentSearch.lastStart=pdfDisplayedCurrentPage,pdfCurrentSearch.lastEnd=pdfDisplayedCurrentPage,t=!0,a=!0;break}if(d>Math.round(pdfDisplayed.numPages/25)+2){readerNotification('Search aborted, took too long.',!0);break}}while(!t);a||(readerNotification('Text was not found.',!0),ungreyoutBottom()),pdfSearchOngoing=!1}}},window.getNextPagesToSearchIn=function(t){if(pdfCurrentSearch.breakOnNext)return[];let i=pdfCurrentSearch.lastStart,d=pdfCurrentSearch.lastEnd,l=25,o=-1,r=l;return'left'===t?(null===i?(o=a(pdfDisplayedCurrentPage-l,1),r=e(l,pdfDisplayedCurrentPage-o)):1===i?o=a(pdfDisplayed.numPages-l,1):d===i&&1!==d&&1<pdfDisplayed.numPages?(o=a(i-l-1,1),r=1===o?a(0,e(l,pdfDisplayedCurrentPage-3)):e(l,pdfDisplayedCurrentPage-o-1)):(o=a(i-l,1),1===o&&(r=a(0,i-2))),null!==i&&i>pdfDisplayedCurrentPage&&o<=pdfDisplayedCurrentPage?(o=pdfDisplayedCurrentPage,pdfCurrentSearch.breakOnNext=!0):1===pdfDisplayed.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)):(null===i?(o=pdfDisplayedCurrentPage,r=e(pdfDisplayed.numPages-o,l)):d===pdfDisplayed.numPages?(o=1,r=e(l,pdfDisplayed.numPages)):(o=d+1,r=e(pdfDisplayed.numPages-o,l)),null!==d&&d<pdfDisplayedCurrentPage&&o+l>=pdfDisplayedCurrentPage?(r=pdfDisplayedCurrentPage-o,pdfCurrentSearch.breakOnNext=!0):null!==d&&d===pdfDisplayed.numPages&&1+l>=pdfDisplayedCurrentPage?(r=pdfDisplayedCurrentPage-o,pdfCurrentSearch.breakOnNext=!0):1===pdfDisplayed.numPages&&(r=0,pdfCurrentSearch.breakOnNext=!0)),1===o&&pdfDisplayed.numPages<=r&&(pdfCurrentSearch.breakOnNext=!0),pdfCurrentSearch.lastStart=o,pdfCurrentSearch.lastEnd=e(pdfDisplayed.numPages,o+r),{s:o,n:r}},window.highlightPDFText=function(e,s=0){var n=document.getElementById('text-layer').querySelectorAll('span');if(0===n.length)return void(3>s&&setTimeout(function(){highlightPDFText(e,s+1)},200));let d=e.toLowerCase().split(' ');for(var l=0;l<d.length;l++)for(var i=0;i<n.length;i++)if(-1!==n[i].innerHTML.toLowerCase().indexOf(d[l])){var t=new RegExp(escapeRegExp(d[l]),'ig');n[i].innerHTML=n[i].innerHTML.replace(t,'<span class=\'tl-highlight\'>$&</span>')}document.getElementById('siac-pdf-top').scrollTop=a(0,$('#text-layer .tl-highlight').first()[0].parentElement.offsetTop-50)}},function(){var e=Math.abs;window.pdfImgSel={canvas:null,context:null,startX:null,endX:null,startY:null,endY:null,cvsOffLeft:null,cvsOffTop:null,mouseIsDown:!1,canvasDispl:null},window.pdfImgMouseUp=function(){if(pdfImgSel.mouseIsDown){pdfImgSel.mouseIsDown=!1,drawSquare();var e=activeCanvas();cropSelection(e,pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY,insertImage),$(pdfImgSel.canvas).remove(),$('#text-layer').show()}},window.pageSnapshot=function(){var e=activeCanvas();cropSelection(e,0,0,e.offsetWidth,e.offsetHeight,insertImage)},window.cropSelection=function(e,t,i,n,a,s){let d=document.createElement('canvas'),l=d.getContext('2d');d.width=n,d.height=a,l.drawImage(e,t*window.devicePixelRatio,i*window.devicePixelRatio,n*window.devicePixelRatio,a*window.devicePixelRatio,0,0,d.width,d.height),s(d.toDataURL())},window.insertImage=function(e){pycmd('siac-add-image 1 '+e.replace('image/png',''))},window.pdfImgMouseDown=function(e){pdfImgSel.canvasDispl=activeCanvas().offsetLeft,pdfImgSel.mouseIsDown=!0,pdfImgSel.cvsOffLeft=$(pdfImgSel.canvas).offset().left,pdfImgSel.cvsOffTop=$(pdfImgSel.canvas).offset().top,pdfImgSel.startX=pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.startY=pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare()},window.initImageSelection=function(){if($('#text-layer').is(':hidden'))return $(pdfImgSel.canvas).remove(),void $('#text-layer').show();disableAreaHighlight(),$('#text-layer').hide(),pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfImgMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e},window.pdfImgMouseXY=function(e){pdfImgSel.mouseIsDown&&(pdfImgSel.endX=e.clientX-pdfImgSel.cvsOffLeft,pdfImgSel.endY=e.clientY-pdfImgSel.cvsOffTop,drawSquare())},window.drawSquare=function(){pdfImgSel.context.clearRect(0,0,pdfImgSel.context.canvas.width,pdfImgSel.context.canvas.height),pdfImgSel.context.fillRect(pdfImgSel.startX*window.devicePixelRatio,pdfImgSel.startY*window.devicePixelRatio,e(pdfImgSel.startX-pdfImgSel.endX)*window.devicePixelRatio,e(pdfImgSel.startY-pdfImgSel.endY)*window.devicePixelRatio),pdfImgSel.context.fillStyle='yellow',pdfImgSel.context.fill()},window.clearImgSelectionCanvas=function(){if(pdfImgSel.canvas){let e=pdfImgSel.canvas.getContext('2d');e.clearRect(0,0,e.canvas.width,e.canvas.height)}},window.initAreaHighlight=function(){pdfImgSel.canvas=activeCanvas();var e=document.createElement('canvas');e.oncontextmenu=disableAreaHighlight,pdfImgSel.canvas.parentNode.insertBefore(e,pdfImgSel.canvas.nextSibling),$(e).css({width:pdfImgSel.canvas.width/window.devicePixelRatio+'px',height:pdfImgSel.canvas.height/window.devicePixelRatio+'px',top:'0',left:document.getElementById('text-layer').style.left,position:'absolute',"z-index":999999,opacity:.3,cursor:'crosshair'}),e.setAttribute('width',pdfImgSel.canvas.width),e.setAttribute('height',pdfImgSel.canvas.height),pdfImgSel.context=e.getContext('2d'),e.addEventListener('mousedown',function(t){pdfImgMouseDown(t)},!1),e.addEventListener('mouseup',function(t){pdfAreaHighlightMouseUp(t)},!1),e.addEventListener('mousemove',function(t){pdfImgMouseXY(t)},!1),pdfImgSel.canvas=e},window.disableAreaHighlight=function(){return pdfImgSel.canvas&&$(pdfImgSel.canvas).remove(),!1},window.pdfAreaHighlightMouseUp=function(){pdfImgSel.mouseIsDown&&(pdfImgSel.mouseIsDown=!1,drawSquare(),Highlighting.createAreaHighlight(pdfImgSel.startX,pdfImgSel.startY,pdfImgSel.endX-pdfImgSel.startX,pdfImgSel.endY-pdfImgSel.startY),clearImgSelectionCanvas())}},function(){var t=Math.min;window.onPDFCopy=function(i){sel=getSelection();let e=sel.getRangeAt(0),n=nodesInSelection(e);if(!n)return;let a='',s=0,d=0,l=0,o=0,r=[],c=null;for(let e=0;e<n.length;e++)(n[e].offsetLeft<s||n[e].offsetTop>d+5)&&!n[e].innerText.startsWith(' ')?(c&&4<Math.abs(+n[e].style.fontSize.substring(0,n[e].style.fontSize.indexOf('px'))-c)?(a+='\n\n'+n[e].innerText,o+=2):0<r.length&&n[e].offsetTop-d>r.slice(-1)[0]+2?(a+='\n\n'+n[e].innerText,o+=2):a.endsWith('-')?(a=a.substring(0,a.length-1)+n[e].innerText,o--):(a+=' '+n[e].innerText,o++),0!==d&&r.push(n[e].offsetTop-d),c=+n[e].style.fontSize.substring(0,n[e].style.fontSize.indexOf('px'))):s+l<n[e].offsetLeft-2&&!n[e].innerText.startsWith(' ')?(a+=' '+n[e].innerText,o++):a+=n[e].innerText,s=n[e].offsetLeft,d=n[e].offsetTop,l=n[e].offsetWidth;let g=sel.toString();if(!a.length&&g.length&&(a=g),a=a.replace('  ',' '),!g.startsWith(a.substring(0,t(10,a.length))))for(var f=10;0<f;f--)if(0<a.indexOf(g.substring(0,t(f,g.length)))){a=a.substring(a.indexOf(g.substring(0,t(f,g.length))));break}if(a.length>g.length+o)for(var p=10;0<p;p--){let e=g.substring(g.length-t(g.length,p));if(0<=a.lastIndexOf(e)){a=a.substring(0,a.lastIndexOf(e)+e.length);break}}a=a.replace(/( |&nbsp;){2,}/g,' '),a=a.replace(/ ([,.;:]) /g,'$1 '),a=a.replace(/ ([)\].!?:])/g,'$1'),a=a.replace(/([(\[]) /g,'$1'),i.clipboardData.setData('text/plain',a),i.preventDefault()},window.pdfLeftTabPdfSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-pdf-search '+e)},window.pdfLeftTabAnkiSearchKeyup=function(e,t){13!==t.keyCode||e&&0<e.trim().length&&pycmd('siac-pdf-left-tab-anki-search '+e)},window.pdfViewerKeyup=function(e){e.ctrlKey&&(39===e.keyCode||32===e.keyCode&&e.shiftKey)?(e.shiftKey&&pdfDisplayed&&-1===pagesRead.indexOf(pdfDisplayedCurrentPage)&&(!pdfExtract||pdfExtract[0]<=pdfDisplayedCurrentPage&&pdfExtract[1]>=pdfDisplayedCurrentPage)&&(pycmd('siac-pdf-page-read '+$('#siac-pdf-top').data('pdfid')+' '+pdfDisplayedCurrentPage+' '+numPagesExtract()),pagesRead.length?pagesRead.push(pdfDisplayedCurrentPage):pagesRead=[pdfDisplayedCurrentPage],updatePdfProgressBar()),pdfPageRight()):e.ctrlKey&&74===e.keyCode?pdfPageRight():e.ctrlKey&&(37===e.keyCode||75===e.keyCode)?pdfPageLeft():(e.ctrlKey||e.metaKey)&&e.shiftKey&&65===e.keyCode&&0<Highlighting.colorSelected.id&&(readerNotification('&nbsp;Area Highlight&nbsp;'),initAreaHighlight(),pdfTextLayerMetaKey=!1)},window.pdfTooltipClozeKeyup=function(e){try{if(e.ctrlKey&&e.shiftKey&&67===e.keyCode){let e=window.getSelection().toString();if(!e||0===e.length)return;let i=document.getElementById('siac-pdf-tooltip-results-area').innerHTML;for(var t=1;20>t;t++)if(-1===i.indexOf('{{c'+t+'::')){i=i.split(e).join('<span style=\'color: lightblue;\'>{{c'+t+'::'+e+'}}</span>'),document.getElementById('siac-pdf-tooltip-results-area').innerHTML=i;break}}}catch(e){pycmd('siac-notification Something went wrong during clozing:<br> '+e.message)}},window.markClicked=function(e){'siac-page-mark-link'===e.target.className&&(pdfDisplayedCurrentPage=+e.target.innerHTML,queueRenderPage(pdfDisplayedCurrentPage,!0))},window.textlayerClicked=function(t,i){if(!t.ctrlKey&&!windowHasSelection()&&($('#siac-pdf-tooltip').hide(),'none'!==i.style.pointerEvents)){i.style.pointerEvents='none';let n=$.Event('click');n.ctrlKey=!0,$(document.elementFromPoint(t.clientX,t.clientY)).trigger(n),i.style.pointerEvents='auto'}},window.queueLinkContextMenu=function(e,t){return e.preventDefault(),document.body.style.overflowY='hidden',$(document.body).append(`
        <div onmouseleave='$(this).remove();' style='position: absolute; z-index: 1000; left: ${e.pageX}px; top: ${e.pageY-30}px; width: 100px; height: 20px; text-align: center;' class='siac-pdf-contextmenu'> 
            <div>    
                <a class='siac-clickable-anchor' style='color: lightgrey;' onclick='pycmd("siac-eval index.ui.reading_modal.show_remove_dialog(${t})")'>Remove / Delete</a>
            </div>
        </div>
    `),!1},window.pdfKeyup=function(t){if(!t.ctrlKey&&!t.metaKey&&pdfTooltipEnabled&&windowHasSelection()){$('#text-layer .tl-highlight').remove();let e=window.getSelection(),t=e.getRangeAt(0),i=e.toString();if(0===i.trim().length||500<i.length)return;$('#text-layer > span').css('height','auto');let n=nodesInSelection(t),a=getSentencesAroundSelection(t,n,i);1<n.length&&(i=joinTextLayerNodeTexts(n,i));let s=t.getBoundingClientRect(),d=document.getElementById('siac-reading-modal').getBoundingClientRect();document.getElementById('siac-pdf-tooltip-results-area').innerHTML='Searching...',document.getElementById('siac-pdf-tooltip-searchbar').value='';let l=s.left-d.left;250>d.width-l&&(l-=200),$('#siac-pdf-tooltip').css({top:s.top-d.top+s.height+'px',left:l+'px'}).show(),pycmd('siac-pdf-selection '+i),$('#siac-pdf-tooltip').data('sentences',a),$('#siac-pdf-tooltip').data('selection',i),$('#text-layer > span').css('height','200px')}else(t.ctrlKey||t.metaKey)&&0<Highlighting.colorSelected.id&&windowHasSelection()?(Highlighting.highlight(),pdfTextLayerMetaKey=!1):(t.ctrlKey||t.metaKey)&&0===Highlighting.colorSelected.id&&!windowHasSelection()&&Highlighting.insertText(t)},window.pdfMouseWheel=function(e){(e.ctrlKey||e.metaKey)&&(0>e.deltaY?pdfScaleChange('up'):0<e.deltaY&&pdfScaleChange('down'),e.preventDefault())}},function(){},function(e,t,i){'use strict';var n=Math.floor,a=Math.min,s=Math.abs,d=Math.max;i.r(t);var l=i(1),o=i(2),r=i(3),c=i(4);const g={colorSelected:{id:1,color:'red'},current:[],highlight:function(){let e=window.getSelection(),t=e.getRangeAt(0);$('#text-layer > span').css('height','auto');let i=t.getClientRects();if(100<i.length)return void readerNotification('Selection too long to highlight.');let n=this._fuseOverlappingClientRects(i),a=document.getElementById('text-layer').getBoundingClientRect(),s=document.getElementById('text-layer').offsetLeft,d=pdfDisplayedCurrentPage+' -1 '+this.colorSelected.id+' ';n.forEach((e)=>{let t=e.x-a.x,i=e.y-a.y,n=pdfDisplayedViewPort.convertToPdfPoint(t,i);d+=n[0]+' '+n[1]+' ',n=pdfDisplayedViewPort.convertToPdfPoint(t+e.w,i+e.h),d+=n[0]+' '+n[1]+' '}),d+='# '+e.toString(),e.removeAllRanges(),pycmd('siac-hl-new '+d),$('#text-layer > span').css('height','100px')},createAreaHighlight:function(e,i,n,a){let s=this.colorSelected.id;if(!(1>s||2>n&&2>a)){6<=s&&(s+=3,e-=3,i-=3);let t=pdfDisplayedViewPort.convertToPdfPoint(e,i),d=pdfDisplayedViewPort.convertToPdfPoint(e+n,i+a),l=`siac-hl-new ${pdfDisplayedCurrentPage} -1 ${s} ${t[0]} ${t[1]} ${d[0]} ${d[1]} # `;pycmd(l)}},insertText:function(e){let t=document.getElementById('text-layer').getBoundingClientRect(),i=document.getElementById('text-layer').offsetLeft,n=e.clientX-t.x,a=e.clientY-t.y;this._createHighlightDiv(n+i,a,100,20,this.colorSelected.id,'');let s=pdfDisplayedCurrentPage+' -1 0 ',d=pdfDisplayedViewPort.convertToPdfPoint(n,a);s+=d[0]+' '+d[1]+' ',d=pdfDisplayedViewPort.convertToPdfPoint(n+100,a+20),s+=d[0]+' '+d[1]+' #',pycmd('siac-hl-new '+s)},displayFakeHighlight:function(){this._createHighlightDiv(0,0,50,50,1,-1)},displayHighlights:function(){this._removeAllHighlights();let e=activeCanvas();if(e){let t=document.getElementById('siac-pdf-overflow').scrollTop;this.current.forEach((i)=>{let n=i[0],d=i[1],l=i[2],o=i[3],r=i[4],t=i[5],c=i[6],g=pdfDisplayedViewPort.convertToViewportRectangle([n,d,l,o]),f=a(g[0],g[2]);f+=e.offsetLeft;let p=a(g[1],g[3]),u=s(g[0]-g[2]),m=s(g[1]-g[3]);this._createHighlightDiv(f,p,u,m,r,t,c)}),document.getElementById('siac-pdf-overflow').scrollTop=t}},_removeAllHighlights:function(){for(let e=document.getElementsByClassName('siac-hl');e[0];)e[0].parentNode.removeChild(e[0])},_colorById:function(e){return 0===e?'white':1===e?'#e65100':2===e?'#558b2f':3===e?'#2196f3':4===e?'#ffee58':5===e?'#ab47bc':6===e||9===e?'#e65100':7===e||10===e?'#558b2f':8===e||11===e?'#2196f3':void 0},_fuseOverlappingClientRects:function(e){let t,i,l,o=!0,r=0,c=[];for(var g=0;g<e.length;g++)c.push({x:e[g].x,y:e[g].y,w:e[g].width,h:e[g].height});if(1===c.length)return c;for(;o;){o=!1;let e=[],g=0;for(var n=0;n<c.length;n++)if(!(o&&g===n)){if(t=c[n].x,i=c[n].y,l=c[n].w,r=c[n].h,!o)for(g=0;g<c.length;g++)if(g!==n&&(c[g].x===t&&c[g].y===i&&c[g].w===l&&c[g].h!==r?(r=d(c[g].h,r),o=!0):c[g].x===t&&c[g].y===i&&c[g].w!==l&&c[g].h===r?(l=d(c[g].w,l),o=!0):c[g].x===t&&c[g].y!==i&&c[g].w===l&&c[g].h===r?(i=a(i,c[g].y),o=!0):c[g].x!==t&&c[g].y===i&&c[g].w===l&&c[g].h===r?(t=a(t,c[g].x),o=!0):c[g].x!==t&&c[g].y===i&&c[g].w===l&&c[g].h!==r&&100>s(c[g].h-r)?(t=a(t,c[g].x),r=d(c[g].h,r),o=!0):c[g].x!==t&&c[g].y===i&&c[g].h===r?(c[g].x<t?(l=t+l-c[g].x,t=c[g].x):l=c[g].x+c[g].w-t,o=!0):c[g].x===t&&c[g].w===l?(r=d(c[g].h,r,d(i+r,c[g].y+c[g].h)-a(c[g].y,i)),i=a(c[g].y,i),o=!0):c[g].y>i&&c[g].y+c[g].h<i+r?(l=d(c[g].w,l,c[g].x+c[g].w-a(c[g].x,t),t+l-a(c[g].x,t)),t=a(c[g].x,t),o=!0):s(c[g].y-i)<r&&(l=d(c[g].w,l,c[g].x+c[g].w-a(c[g].x,t),t+l-a(c[g].x,t)),i=a(c[g].y,i),r=c[g].h+s(c[g].y-i),o=!0),o)){g<n&&e.splice(g,1);break}-1===e.indexOf({x:t,y:i,w:l,h:r})&&e.push({x:t,y:i,w:l,h:r})}if(o&&c.length===e.length)return console.log('something went terribly wrong'),c;c=Array.from(e)}return c},onColorBtn:function(e){this.colorSelected={id:+$(e).data('id'),color:$(e).data('color')},$('.siac-pdf-color-btn,.siac-pdf-ul-btn').removeClass('active'),$(e).addClass('active'),pycmd('siac-hl-clicked '+this.colorSelected.id+' '+this.colorSelected.color),0<this.colorSelected.id?readerNotification('CTRL + select to Highlight<br>CTRL + Shift + A to Area Highlight'):readerNotification('CTRL + click to insert text<br>CTRL + click again to remove')},onTextMouseUp:function(e,t){if(t.dataset.id&&(t.offsetWidth!=t.dataset.ow||t.clientHeight!=t.dataset.oh)){t.dataset.ow=t.offsetWidth,t.dataset.oh=t.clientHeight;let e=document.getElementById('text-layer').getBoundingClientRect(),i=t.offsetLeft-activeCanvas().offsetLeft,n=t.offsetTop,a=i+t.offsetWidth-6,s=n+t.clientHeight,d=pdfDisplayedViewPort.convertToPdfPoint(i,n);i=d[0],n=d[1],d=pdfDisplayedViewPort.convertToPdfPoint(a,s),a=d[0],s=d[1],pycmd(`siac-hl-text-update-coords ${t.dataset.id} ${i} ${n} ${a-2} ${s+2}`)}},onTextBlur:function(e){e.dataset.id&&pycmd(`siac-hl-text-update-text ${e.dataset.id} ${pdfDisplayedCurrentPage} ${$(e).val()}`)},onTextKeyup:function(e){$(e).height(1),$(e).height($(e).prop('scrollHeight')+1),this.onTextMouseUp(null,e)},hlClick:function(e,t){!t.dataset.id||(e.ctrlKey||e.metaKey)&&(this.current=this.current.filter((e)=>e[5]!=t.dataset.id),pycmd('siac-hl-del '+t.dataset.id),$(t).remove())},_createHighlightDiv:function(e,i,n,a,s,t=-1,d=''){let l;return 0<s?(l=document.createElement('div'),l.className='siac-hl siac-hl-c',l.style.height=a+'px',l.style.width=n+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.setAttribute('onclick','Highlighting.hlClick(event, this);'),6<=s&&9>s?l.style.borderBottom='3px solid '+this._colorById(s):9<=s?l.style.border='3px solid '+this._colorById(s):l.style.background=this._colorById(s)):(l=document.createElement('textarea'),l.className='siac-hl siac-text-hl',l.style.height=a+'px',l.style.width=n+'px',l.style.top=i+'px',l.style.left=e+'px',-1!==t&&(l.dataset.id=t),l.value=d,l.setAttribute('onclick','Highlighting.hlClick(event, this);'),l.style.background=this._colorById(s),l.setAttribute('onmouseup','Highlighting.onTextMouseUp(event, this);'),l.setAttribute('onblur','Highlighting.onTextBlur(this);'),l.setAttribute('onkeyup','Highlighting.onTextKeyup(this);')),document.getElementById('siac-pdf-overflow').append(l),l}};if(window.Highlighting=g,window.remainingSeconds=1800,window.readingTimer=null,window.pdfDisplayed=null,window.pdfDisplayedViewPort=null,window.pdfPageRendering=!1,window.pdfDisplayedCurrentPage=null,window.pdfDisplayedScale=2,window.pdfHighDPIWasUsed=!1,window.pdfColorMode='Day',window.pageNumPending=null,window.latestRenderTimestamp=null,window.pagesRead=[],window.pdfExtract=null,window.pdfDisplayedMarks=null,window.pdfDisplayedMarksTable=null,window.pdfLastReadPages={},window.noteLoading=!1,window.pdfLoading=!1,window.modalShown=!1,window.pdfTooltipEnabled=!0,window.iframeIsDisplayed=!1,window.pageSidebarDisplayed=!0,window.pdfFullscreen=!1,window.pdfBarsHidden=!1,window.displayedNoteId=null,window.pdfTextLayerMetaKey=!1,window.pdfNotification={queue:[],current:''},window.textEditor=null,'undefined'==typeof f)var f=window;window.activeCanvas=function(){let e=document.getElementById('siac-pdf-canvas');return e?'none'===e.style.display?document.getElementById('siac-pdf-canvas_1'):e:null},window.pdfFitToPage=function(){iframeIsDisplayed||rerenderPDFPage(pdfDisplayedCurrentPage,!1,!0)},window.queueRenderPage=function(e,t=!0,i=!1,n=!1,a='',s=!0){pdfPageRendering?pageNumPending=e:rerenderPDFPage(e,t,i,n,a,s)},window.rerenderPDFPage=function(e,t=!0,i=!1,n=!1,a='',s=!0){!pdfDisplayed||iframeIsDisplayed||(document.getElementById('siac-pdf-tooltip').style.display='none',document.getElementById('siac-pdf-page-lbl').innerHTML=`${pdfDisplayedCurrentPage} / ${pdfDisplayed.numPages}`,g._removeAllHighlights(),pdfLoading=!0,pdfDisplayed.getPage(e).then(function(d){updatePdfDisplayedMarks(),pdfPageRendering=!0;var l=new Date().getTime();latestRenderTimestamp=l;var o=document.getElementById('siac-pdf-canvas');if('none'!==o.style.display&&(o=document.getElementById('siac-pdf-canvas_1')),i){var r=d.getViewport({scale:1});pdfDisplayedScale=(o.parentNode.clientWidth-23)/r.width}var r=d.getViewport({scale:pdfDisplayedScale});o.height=r.height*window.devicePixelRatio,o.width=r.width*window.devicePixelRatio,(1!==window.devicePixelRatio||pdfHighDPIWasUsed)&&(pdfHighDPIWasUsed=!0,o.style.height=r.height+'px',o.style.width=r.width+'px');var c=o.getContext('2d'),f=d.render({canvasContext:c,viewport:r,transform:1===window.devicePixelRatio?null:[window.devicePixelRatio,0,0,window.devicePixelRatio,0,0],continueCallback:function(e){latestRenderTimestamp!=l||e()}});return null===pageNumPending?void(f.promise.then(function(){return('siac-pdf-canvas'===o.id?document.getElementById('siac-pdf-canvas_1').style.display='none':document.getElementById('siac-pdf-canvas').style.display='none',o.style.display='inline-block',pdfPageRendering=!1,null!==pageNumPending)?(rerenderPDFPage(pageNumPending,t),pageNumPending=null,null):(-1!==['Sand','Peach','Night','X1','X2','Mud','Coral'].indexOf(pdfColorMode)&&invertCanvas(c),d.getTextContent({normalizeWhitespace:!1,disableCombineTextItems:!1}))}).catch(function(e){return console.log(e),Promise.reject()}).then(function(e){return e?void(pageNumPending||($('#text-layer').css({height:o.height/window.devicePixelRatio,width:o.width/window.devicePixelRatio+1,left:o.offsetLeft}).html(''),pdfjsLib.renderTextLayer({textContent:e,container:document.getElementById('text-layer'),viewport:r,textDivs:[]}),a?highlightPDFText(a):resetSearch(),pdfLoading=!1,(n||a)&&ungreyoutBottom(),n&&setTimeout(function(){refreshCanvas()},3e3),pdfDisplayedViewPort=r,s?(g.current=[],pycmd('siac-pdf-page-loaded '+pdfDisplayedCurrentPage)):g.displayHighlights(),setLastReadPage())):Promise.reject()}),!pageNumPending&&(t&&(o.parentElement.scrollTop=0),-1===pagesRead.indexOf(e)?(document.getElementById('siac-pdf-overlay').style.display='none',document.getElementById('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i>&nbsp; Read'):(document.getElementById('siac-pdf-overlay').style.display='block',document.getElementById('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i>&nbsp; Unread'),s&&pdfExtract&&(pdfExtract[0]>pdfDisplayedCurrentPage||pdfExtract[1]<pdfDisplayedCurrentPage?$('#siac-pdf-top').addClass('extract'):$('#siac-pdf-top').removeClass('extract')),s&&pageSidebarDisplayed&&pycmd(`siac-linked-to-page ${pdfDisplayedCurrentPage} ${pdfDisplayed.numPages}`))):(rerenderPDFPage(pageNumPending,t),pageNumPending=null,Promise.reject())}).catch(function(e){setTimeout(function(){console.log(e)})}))},window.invertCanvas=function(e){'Night'===pdfColorMode?colorize(e,'#2496dc',.4):'X1'===pdfColorMode?(invert(e),colorize(e,'teal',.4),darken(e,'lightsalmon')):'X2'===pdfColorMode?(invert(e),colorize(e,'darkslategrey',.4),darken(e,'coral')):'Mud'===pdfColorMode?(invert(e),colorize(e,'coral',.3),darken(e,'coral')):'Coral'===pdfColorMode?darken(e,'#ffb89e'):'Sand'===pdfColorMode?darken(e,'#ffebb3'):'Peach'===pdfColorMode&&darken(e,'#ffcba4'),e.canvas.style.display='inline-block'},window.refreshCanvas=function(){try{const e=activeCanvas().getContext('2d');e.putImageData(e.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)}catch(t){}},window.pdfPageRight=function(){!pdfDisplayed||iframeIsDisplayed||pdfDisplayedCurrentPage<pdfDisplayed.numPages&&(pdfDisplayedCurrentPage++,queueRenderPage(pdfDisplayedCurrentPage))},window.pdfPageLeft=function(){!pdfDisplayed||iframeIsDisplayed||1<pdfDisplayedCurrentPage&&(pdfDisplayedCurrentPage--,queueRenderPage(pdfDisplayedCurrentPage))},window.togglePageRead=function(e){!pdfDisplayed||pdfExtract&&(pdfDisplayedCurrentPage<pdfExtract[0]||pdfDisplayedCurrentPage>pdfExtract[1])||(!e&&(e=displayedNoteId),-1===pagesRead.indexOf(pdfDisplayedCurrentPage)?(document.getElementById('siac-pdf-overlay').style.display='block',document.getElementById('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i>&nbsp; Unread',pycmd('siac-pdf-page-read '+e+' '+pdfDisplayedCurrentPage+' '+numPagesExtract()),pagesRead.length?pagesRead.push(pdfDisplayedCurrentPage):pagesRead=[pdfDisplayedCurrentPage]):(document.getElementById('siac-pdf-overlay').style.display='none',document.getElementById('siac-pdf-read-btn').innerHTML='<i class="fa fa-book" aria-hidden="true"></i>&nbsp; Read',pycmd('siac-pdf-page-unread '+e+' '+pdfDisplayedCurrentPage+' '+numPagesExtract()),pagesRead.splice(pagesRead.indexOf(pdfDisplayedCurrentPage),1)),updatePdfProgressBar())},window.pdfHidePageReadMark=function(){document.getElementById('siac-pdf-overlay').style.display='none',document.getElementById('siac-pdf-read-btn').innerHTML='\u2713&nbsp; Read'},window.pdfShowPageReadMark=function(){document.getElementById('siac-pdf-overlay').style.display='block',document.getElementById('siac-pdf-read-btn').innerHTML='&times; Unread'},window.pdfJumpToPage=function(t,e){if(13!==t.keyCode)return;let i=e.value;i=a(pdfDisplayed.numPages,i),pdfDisplayedCurrentPage=i,queueRenderPage(pdfDisplayedCurrentPage)},window.pdfScaleChange=function(e){'up'===e?pdfDisplayedScale+=.1:(pdfDisplayedScale-=.1,pdfDisplayedScale=d(.1,pdfDisplayedScale)),queueRenderPage(pdfDisplayedCurrentPage,!1,!1,!1,'',!1)},window.setAllPagesRead=function(){if(!pdfExtract)pagesRead=Array.from(Array(pdfDisplayed.numPages).keys()).map((e)=>++e);else{pagesRead=[];for(var e=pdfExtract[0];e<=pdfExtract[1];e++)pagesRead.push(e)}-1!==pagesRead.indexOf(pdfDisplayedCurrentPage)&&pdfShowPageReadMark()},window.saveTextNote=function(e){let t='';try{t=textEditor.value()}catch(t){return void pycmd('siac-notification Could not save text note for some reason.')}readerNotification('&nbsp;<i class=\'fa fa-save\'></i>&nbsp; Note saved.&nbsp;'),pycmd('siac-update-note-text '+e+' '+t)},window.toggleQueue=function(){if(!(noteLoading||pdfLoading||modalShown)){let e=$('#siac-queue-sched-wrapper');e.hasClass('active')?(e.css({"max-width":'0px',overflow:'hidden'}),$('.siac-queue-sched-btn:first').addClass('active')):(e.css({"max-width":'500px',overflow:'visible'}),$('.siac-queue-sched-btn:first').removeClass('active')),e.toggleClass('active')}},window.queueSchedBtnClicked=function(e){$('#siac-queue-lbl').hide(),$('.siac-queue-sched-btn').removeClass('active'),toggleQueue(),$(e).addClass('active')},window.onQuickSchedBtnClicked=function(e){$(e).hasClass('expanded')?$(e).toggleClass('expanded'):pycmd('siac-quick-schedule-fill')},window.setLastReadPage=function(){pdfLastReadPages[displayedNoteId]=pdfDisplayedCurrentPage},window.getLastReadPage=function(){return displayedNoteId&&displayedNoteId in pdfLastReadPages?pdfLastReadPages[displayedNoteId]:null},window.updatePdfProgressBar=function(){let e=n(10*pagesRead.length/numPagesExtract()),t=`<span style='margin-right: 10px; display: inline-block; min-width: 35px;'>${Math.trunc(100*pagesRead.length/numPagesExtract())} %</span>`;for(var i=0;10>i;i++)t+=i<e?`<div class='siac-prog-sq-filled'></div>`:`<div class='siac-prog-sq'></div>`;document.getElementById('siac-prog-bar-wr').innerHTML=t},window.numPagesExtract=function(){return pdfExtract?pdfExtract[1]-pdfExtract[0]+1:pdfDisplayed.numPages},window.markReadUpToCurrent=function(){for(var e=0;e<pdfDisplayedCurrentPage;e++)-1===pagesRead.indexOf(e+1)&&(!pdfExtract||e+1>=pdfExtract[0]&&e+1<=pdfExtract[1])&&pagesRead.push(e+1);-1!==pagesRead.indexOf(pdfDisplayedCurrentPage)&&pdfShowPageReadMark()},window.afterRemovedFromQueue=function(){toggleQueue(),$('.siac-queue-sched-btn').first().addClass('active').html('Unqueued')},window._startTimer=function(e){readingTimer&&clearInterval(readingTimer),readingTimer=setInterval(function(){remainingSeconds--,document.getElementById(e).innerHTML=n(remainingSeconds/60)+' : '+(10>remainingSeconds%60?'0'+remainingSeconds%60:remainingSeconds%60),0>=remainingSeconds&&(clearInterval(readingTimer),remainingSeconds=1800,$('#siac-timer-play-btn').html('Start').addClass('inactive'),$('.siac-timer-btn').removeClass('active'),$('.siac-timer-btn').eq(4).addClass('active'),document.getElementById(e).innerHTML='30 : 00',pycmd('siac-timer-elapsed '+$('#siac-reading-modal-top-bar').data('nid')),readingTimer=null)},999)},window.toggleTimer=function(e){$(e).hasClass('inactive')?($(e).removeClass('inactive'),e.innerHTML='Pause',_startTimer('siac-reading-modal-timer')):(clearInterval(readingTimer),readingTimer=null,$(e).addClass('inactive'),e.innerHTML='Start')},window.resetTimer=function(e){clearInterval(readingTimer),readingTimer=null,$('.siac-timer-btn').removeClass('active'),$(e).addClass('active'),remainingSeconds=60*+e.innerHTML,document.getElementById('siac-reading-modal-timer').innerHTML=n(remainingSeconds/60)+' : '+(10>remainingSeconds%60?'0'+remainingSeconds%60:remainingSeconds%60),$('#siac-timer-play-btn').addClass('inactive').html('Start')},window.startTimer=function(t){$('.siac-timer-btn').each((n,i)=>{i.innerHTML===t.toString()&&(resetTimer(i),$('#siac-timer-play-btn').trigger('click'))})},window.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')},window.readerNotification=function(e,t){if(e){if(!t&&''!=pdfNotification.current){if(0<pdfNotification.queue.length){if(e===pdfNotification.queue[pdfNotification.queue.length-1])return;}else if(pdfNotification.current===e)return;return void pdfNotification.queue.push(e)}pdfNotification.current=e,document.getElementById('siac-pdf-br-notify').innerHTML=e,document.getElementById('siac-pdf-br-notify').style.display='block',window.setTimeout(()=>{pdfNotification.current='',document.getElementById('siac-pdf-br-notify')?(document.getElementById('siac-pdf-br-notify').style.display='none',pdfNotification.queue.length&&setTimeout(function(){let e=pdfNotification.queue.shift();readerNotification(e,!0)},800)):pdfNotification.queue=[]},3500)}},window.swapReadingModal=function(){let e=document.getElementById('siac-reading-modal');'siac-right-side'===e.parentNode.id?document.getElementById('leftSide').appendChild(e):document.getElementById('siac-right-side').appendChild(e)},window.setPDFColorMode=function(e){$('#siac-pdf-color-mode-btn > span').first().text(e),pdfColorMode=e,rerenderPDFPage(pdfDisplayedCurrentPage,!1),pycmd('siac-update-config-str pdf.color_mode '+e),$('#siac-pdf-top').removeClass('siac-pdf-sand siac-pdf-night siac-pdf-peach siac-pdf-day siac-pdf-rose siac-pdf-moss siac-pdf-coral siac-pdf-x1 siac-pdf-x2 siac-pdf-mud').addClass('siac-pdf-'+pdfColorMode.toLowerCase())},window.joinTextLayerNodeTexts=function(e,t){let n='';for(var a=0;a<e.length;a++){if(e[a].innerHTML===t)return t;n+=e[a].innerHTML+=' '}n=n.replace('  ',' ');let i=n.split(' ');n='';for(var a=0;a<i.length;a++)0<i[a].length&&0<=t.indexOf(i[a])&&(n+=i[a]+' ');return n.trim()},window.nodesInSelection=function(e){var t=document.getElementById('text-layer').children;let n=[],a=!1,s='#text'===e.startContainer.nodeName?e.startContainer.parentNode:e.startContainer,d='#text'===e.endContainer.nodeName?e.endContainer.parentNode:e.endContainer;for(var l=0;l<t.length&&(t[l]==s&&(a=!0),a&&n.push(t[l]),t[l]!=d);l++);return n},window.getSentencesAroundSelection=function(e,t,n){if(!e.startContainer)return;n=n.replace(/  +/g,' ').trim();let a=e.startContainer.parentElement.previousSibling,d='',l=0,o=0;if(1===t.length)d=t[0].innerHTML,l=t[0].clientHeight;else for(var r=0;r<t.length;r++)d+=t[r].innerHTML+' ',l=t[r].clientHeight;o=t[0].offsetTop,d=d.replace(/  +/g,' ').trim();let i=[];for(a||i.push(d);a;){if(5<s(a.clientHeight-l)||o-a.offsetTop>1.5*l){i.push(d);break}o=a.offsetTop,d=(a.innerHTML+' '+d).replace(/  +/g,' ').trim();let e=extractPrev(d,i,n);if(i=e[1],e[0])break;if(a=a.previousSibling,!a){i.push(d);break}}let c=[];for(var r=0;r<i.length;r++)for(d=i[r],a=e.endContainer.parentElement.nextSibling,a||c.push(d);a;){d=(d+' '+a.innerHTML).replace(/  +/g,' ').trim();let e=extractNext(d,c,n);if(c=e[1],e[0])break;if(a=a.nextSibling,!a){c.push(d);break}}return c},window.sendClozes=function(){let e=$('#siac-pdf-tooltip').data('sentences'),t=$('#siac-pdf-tooltip').data('selection');pycmd('siac-show-cloze-modal '+t+'$$$'+e.join('$$$'))},window.generateClozes=function(){let e='';$('.siac-cl-row').each(function(t,i){e+='$$$'+$(i.children[0].children[0]).text()});let t=$('#siac-pdf-top').data('pdfpath'),i=$('#siac-pdf-top').data('pdftitle');pycmd('siac-generate-clozes $$$'+i+'$$$'+t+'$$$'+pdfDisplayedCurrentPage+e),$('#siac-pdf-tooltip').hide()},window.extractPrev=function(e,t,i){e=e.substring(0,e.lastIndexOf(i)+i.length)+e.substring(e.lastIndexOf(i)+i.length).replace(/\./g,'$DOT$');let n=e.match(/.*[^.\d][.!?]"? (.+)/);if(!n||-1===n[1].indexOf(i))return[!1,t];let a=n[1].replace(/\$DOT\$/g,'.');return-1===t.indexOf(a)&&t.push(a),[!0,t]},window.extractNext=function(e,t,i){e=e.substring(0,e.indexOf(i)).replace(/\./g,'$DOT$')+e.substring(e.indexOf(i));let n=e.match(/(.+?(\.\.\.(?!,| [a-z])|[^.]\.(?!(\.|[0-9]|[A-Z]{2,20}))|[!?]|[^0-9]\. [A-Z])).*/);if(!n||-1===n[1].indexOf(i))return[!1,t];let a=n[1].replace(/\$DOT\$/g,'.');return-1===t.indexOf(a)&&t.push(a),[!0,t]},window.pxToSandScheme=function(e,t,i){return 240<e&&240<t&&240<i?{r:241,g:206,b:147}:15>s(e-t)&&15>s(e-i)?(e=d(0,e-40),t=d(0,t-40),i=d(0,i-40),{r:e,g:t,b:i}):100>e&&100>t&&100>i?{r:0,g:0,b:0}:{r:e,g:t,b:i}},window.pxToPeachScheme=function(e,t,i){return 240<e&&240<t&&240<i?{r:237,g:209,b:176}:15>s(e-t)&&15>s(e-i)?(e=d(0,e-40),t=d(0,t-40),i=d(0,i-40),{r:e,g:t,b:i}):100>e&&100>t&&100>i?{r:0,g:0,b:0}:{r:e,g:t,b:i}},window.colorize=function(e,t,i){e.globalCompositeOperation='source-atop',e.globalAlpha=i,e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.globalCompositeOperation='source-over',e.globalAlpha=1},window.invert=function(e){e.globalCompositeOperation='difference',e.fillStyle='white',e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.darken=function(e,t){e.globalCompositeOperation='darken',e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},window.updatePdfDisplayedMarks=function(){if(null==pdfDisplayedMarks)return;let e='';if($('.siac-mark-btn-inner').removeClass('active'),pdfDisplayedCurrentPage in pdfDisplayedMarks)for(var t=0;t<pdfDisplayedMarks[pdfDisplayedCurrentPage].length;t++)switch(pdfDisplayedMarks[pdfDisplayedCurrentPage][t]){case 1:e+='<div class=\'siac-pdf-mark-lbl\'>Revisit &nbsp;<b onclick=\'$(".siac-mark-btn-inner-1").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-1').first().addClass('active');break;case 2:e+='<div class=\'siac-pdf-mark-lbl\'>Hard &nbsp;<b onclick=\'$(".siac-mark-btn-inner-2").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-2').first().addClass('active');break;case 3:e+='<div class=\'siac-pdf-mark-lbl\'>More Info &nbsp;<b onclick=\'$(".siac-mark-btn-inner-3").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-3').first().addClass('active');break;case 4:e+='<div class=\'siac-pdf-mark-lbl\'>More Cards &nbsp;<b onclick=\'$(".siac-mark-btn-inner-4").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-4').first().addClass('active');break;case 5:e+='<div class=\'siac-pdf-mark-lbl\'>Bookmark &nbsp;<b onclick=\'$(".siac-mark-btn-inner-5").trigger("click");\'>&times</b></div>',$('.siac-mark-btn-inner-5').first().addClass('active');}let i=document.getElementById('siac-queue-readings-list').offsetWidth,n=document.getElementById('siac-queue-actions').offsetWidth,a=document.getElementById('siac-reading-modal-bottom-bar').clientWidth-i-n-100;var s='';Object.keys(pdfDisplayedMarksTable).forEach(function(e){let t='';'1'===e?t='Revisit':'2'===e?t='Hard':'3'===e?t='More Info':'4'===e?t='More Cards':'5'===e?t='Bookmark':void 0;let n='';for(var a=0;a<pdfDisplayedMarksTable[e].length;a++)n+='<span class=\'siac-page-mark-link\'>'+pdfDisplayedMarksTable[e][a]+'</span>, ';n=0<n.length?n.substring(0,n.length-2):n,s+=`<tr style='color: grey;'><td><b>${t}</b></td><td>${n}</td></tr>`}),s.length&&(s=`<table style='user-select: none; table-layout: fixed; max-width: ${a}px;'>`+s+'</table>'),document.getElementById('siac-pdf-overlay-top-lbl-wrap')&&(document.getElementById('siac-pdf-overlay-top-lbl-wrap').innerHTML=e),document.getElementById('siac-marks-display')&&(document.getElementById('siac-marks-display').innerHTML=s),onMarkBtnClicked(document.getElementById('siac-mark-jump-btn'))},window.doneShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||$('#siac-first-in-queue-btn').trigger('click')},window.laterShortcut=function(){pdfLoading||noteLoading||modalShown||!document.body.classList.contains('siac-reading-modal-displayed')||!document.getElementById('siac-later-btn')||$('#siac-later-btn').trigger('click')},window.jumpLastPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdfDisplayed||(pdfDisplayedCurrentPage=pdfDisplayed.numPages,queueRenderPage(pdfDisplayedCurrentPage,!0))},window.jumpFirstPageShortcut=function(){pdfLoading||noteLoading||modalShown||!pdfDisplayed||(pdfDisplayedCurrentPage=1,queueRenderPage(1,!0))},window.togglePDFSelect=function(e){e||(e=document.getElementById('siac-pdf-tooltip-toggle')),e&&(pdfTooltipEnabled=!pdfTooltipEnabled,pdfTooltipEnabled?($(e).addClass('active'),readerNotification('Search on select enabled.',!0)):($(e).removeClass('active'),$('#siac-pdf-tooltip').hide(),readerNotification('Search on select disabled.',!0)))},window.onMarkBtnClicked=function(e){$(e).hasClass('expanded')&&(pdfDisplayedMarks&&0<Object.keys(pdfDisplayedMarks).length?document.getElementById('siac-mark-jump-btn-inner').innerHTML='<b onclick=\'event.stopPropagation(); jumpToNextMark();\' style=\'vertical-align: middle;\'>Jump to Next Mark</b>':document.getElementById('siac-mark-jump-btn-inner').innerHTML='<b style=\'vertical-align:middle; color: grey;\'>No Marks in PDF</b>')},window.jumpToNextMark=function(){if(pdfDisplayed){let t=Object.keys(pdfDisplayedMarks);for(var e=0;e<t.length;e++)if(+t[e]>pdfDisplayedCurrentPage)return pdfDisplayedCurrentPage=+t[e],void queueRenderPage(pdfDisplayedCurrentPage,!0,!1,!1);pdfDisplayedCurrentPage=+t[0],queueRenderPage(pdfDisplayedCurrentPage,!0,!1,!1)}},window.bringPDFIntoView=function(){($('#siac-right-side').hasClass('addon-hidden')||$('#switchBtn').is(':visible'))&&toggleAddon()},window.beforeNoteQuickOpen=function(){return!(noteLoading||pdfLoading||modalShown)&&(pdfDisplayed&&(noteLoading=!0,greyoutBottom(),destroyPDF()),bringPDFIntoView(),!0)},window.centerTooltip=function(){let e=$('#siac-pdf-top').width(),t=$('#siac-pdf-top').height(),i=$('#siac-pdf-tooltip');i.css({top:t/2-i.height()/2,left:e/2-i.width()/2})},window.destroyPDF=function(){pdfDisplayed&&pdfDisplayed.destroy(),pdfDisplayed=null},window.pdfUrlSearch=function(e){if(!e.length)return;let t='';$('#siac-iframe-btn tr').each(function(){$(this.children[1].children[0]).is(':checked')&&(t=$(this.children[1].children[0]).data('url'))}),pycmd('siac-url-srch $$$'+e+'$$$'+t),$('#siac-iframe-btn').removeClass('expanded')},window.showQueueInfobox=function(e,t){pdfLoading||noteLoading||modalShown||(pycmd('siac-queue-info '+t),document.documentElement.style.setProperty('--ttop',e.offsetTop+'px'),pdfLoading||noteLoading||modalShown)},window.leaveQueueItem=function(){window.setTimeout(function(){$('#siac-queue-infobox').is(':hover')||$('#siac-queue-readings-list .siac-clickable-anchor:hover').length||hideQueueInfobox()},400)},window.hideQueueInfobox=function(){document.getElementById('siac-queue-infobox')&&(document.getElementById('siac-queue-infobox').style.display='none',document.getElementById('siac-pdf-bottom-tabs').style.visibility='visible')},window.greyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-clickable-anchor,#siac-reading-modal-bottom-bar .fa,.siac-queue-sched-btn,#siac-reading-modal-bottom-bar .siac-queue-picker-icn,#siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').addClass('siac-disabled')},window.ungreyoutBottom=function(){$('#siac-reading-modal-bottom-bar .siac-clickable-anchor,#siac-reading-modal-bottom-bar .fa,.siac-queue-sched-btn,#siac-reading-modal-bottom-bar .siac-queue-picker-icn, #siac-reading-modal-bottom-bar .blue-hover, .siac-page-mark-link,.siac-sched-icn').removeClass('siac-disabled')},window.unhideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-unhide-pdf-queue '+e)},window.hideQueue=function(e){pdfLoading||noteLoading||modalShown||pycmd('siac-hide-pdf-queue '+e)},window.toggleReadingModalBars=function(){pdfBarsHidden?(document.getElementById('siac-reading-modal-top-bar').style.display='flex',document.getElementById('siac-reading-modal-bottom-bar').style.display='block',pdfBarsHidden=!1):(document.getElementById('siac-reading-modal-top-bar').style.display='none',document.getElementById('siac-reading-modal-bottom-bar').style.display='none',pdfBarsHidden=!0)},window.toggleReadingModalFullscreen=function(){pdfFullscreen=!pdfFullscreen,pdfFullscreen?($(document.body).removeClass('siac-fullscreen-show-fields').addClass('siac-fullscreen-show-right'),pdfDisplayed&&pdfFitToPage(),pdfBarsHidden=!1,toggleReadingModalBars(),pycmd('siac-notification Press toggle shortcut (default Ctrl+F) to switch.')):($(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right'),$('#switchBtn').is(':visible')&&$('#outerWr').addClass('onesided'),onWindowResize(),pdfDisplayed&&pdfFitToPage())},window.activateReadingModalFullscreen=function(){pdfFullscreen=!1,pdfBarsHidden=!0,toggleReadingModalFullscreen()},window.onReadingModalClose=function(){pdfLoading||(displayedNoteId=null,$(document.body).removeClass('siac-fullscreen-show-fields').removeClass('siac-fullscreen-show-right').removeClass('siac-reading-modal-displayed'),$('#siac-left-tab-browse,#siac-left-tab-pdfs,#siac-reading-modal-tabs-left').remove(),$('#fields').show(),$('#siac-reading-modal').hide(),document.getElementById('resultsArea').style.display='block',document.getElementById('bottomContainer').style.display='block',document.getElementById('topContainer').style.display='flex',destroyPDF(),document.getElementById('siac-reading-modal-center').innerHTML='',onWindowResize(),window.$fields=$('.field'),siacState.searchOnTyping&&setSearchOnTyping(!0,!1),pycmd('siac-on-reading-modal-close'))},window.tryExtractTextFromTextNote=function(){saveTextNote($('#siac-reading-modal-top-bar').data('nid')),pycmd('siac-try-copy-text-note')},window.modalTabsLeftClicked=function(e,t){$('#siac-reading-modal-tabs-left .siac-btn').removeClass('active'),$(t).addClass('active'),pycmd('siac-reading-modal-tabs-left-'+e)},window.setPdfTheme=function(e){let t=document.getElementById('siac-pdf-css');t.href=t.href.substring(0,t.href.lastIndexOf('/')+1)+e,pycmd('siac-eval update_config(\'pdf.theme\', \''+e+'\')')},window.schedChange=function(e){document.getElementById('siac-sched-prio-val').innerHTML=prioVerbose(e.value)},window.prioVerbose=function(e){return 85<=e?`Very high (<b>${e}</b>)`:70<=e?`High (<b>${e}</b>)`:30<=e?`Medium (<b>${e}</b>)`:15<=e?`Low (<b>${e}</b>)`:1<=e?`Very low (<b>${e}</b>)`:'Remove from Queue (<b>0</b>)'},window.schedChanged=function(e,t){$('#siac-quick-sched-btn').removeClass('expanded'),pycmd('siac-requeue '+t+' '+e.value)},window.schedSmallChanged=function(e,t){pycmd('siac-requeue '+t+' '+e.value)},window.schedSmallChange=function(e){document.getElementById('siac-slider-small-lbl').innerHTML=e.value},window.scheduleDialogQuickAction=function(){let e=$('input[name=sched]:checked').data('pycmd');pycmd(`siac-eval index.ui.reading_modal.schedule_note(${e})`)},window.removeDialogOk=function(e){'1'==$('input[name=del]:checked').data('pycmd')?pycmd('siac-remove-from-queue '+e):pycmd('siac-delete-current-user-note '+e),modalShown=!1,$('#siac-rm-greyout').hide(),$('#siac-schedule-dialog').hide()},window.updateSchedule=function(){let e=$('input[name=sched]:checked').data('pycmd');if('4'==e){let e=document.getElementById('siac-sched-td-inp').value;if(!e)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule td '+e)}else if('5'==e){let e='';if($('#siac-sched-wd input').each(function(t){$(this).is(':checked')&&(e+=(t+1).toString())}),!e.length)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule wd '+e)}else{let e=document.getElementById('siac-sched-id-inp').value;if(!e)return void pycmd('siac-notification Value is empty!');pycmd('siac-update-schedule id '+e)}},window.togglePageSidebar=function(e=!0){pageSidebarDisplayed=!pageSidebarDisplayed,pageSidebarDisplayed?($('#siac-reading-modal-center').addClass('siac-page-sidebar'),e&&pycmd(`siac-linked-to-page ${pdfDisplayedCurrentPage} ${pdfDisplayed.numPages}`)):$('#siac-reading-modal-center').removeClass('siac-page-sidebar'),e&&(pdfFitToPage(),pycmd('siac-config-bool pdf.page_sidebar_shown '+pageSidebarDisplayed))},window.updatePageSidebarIfShown=function(){pdfDisplayed&&pageSidebarDisplayed&&pycmd(`siac-linked-to-page ${pdfDisplayedCurrentPage} ${pdfDisplayed.numPages}`)},window.editorMDInit=function(){textEditor=new SimpleMDE({element:document.getElementById('siac-text-top').children[0],indentWithTabs:!0,autoDownloadFontAwesome:!1,autosave:{enabled:!1},placeholder:'',status:!1,tagSize:4,toolbar:['bold','italic','heading','code','quote','unordered-list','ordered-list','horizontal-rule','link']})},window.modalBgUpdate=function(){$('#siac-modal-bg-update .siac-clickable-anchor').addClass('siac-disabled'),setTimeout(function(){$('#siac-modal-bg-update .siac-clickable-anchor').removeClass('siac-disabled')},1200)},window.windowHasSelection=function(){return window.getSelection().toString().length};i(5)}]));